"use strict";(self.webpackChunkshop_map_react=self.webpackChunkshop_map_react||[]).push([[5139],{11873:function(e,t,r){function n(){return[1,0,0,0,1,0,0,0,1]}function i(e,t,r,n,i,a,s,o,l){return[e,t,r,n,i,a,s,o,l]}function a(e,t){return new Float64Array(e,t,9)}r.d(t,{a:function(){return a},c:function(){return n},f:function(){return i}});Object.freeze(Object.defineProperty({__proto__:null,clone:function(e){return[e[0],e[1],e[2],e[3],e[4],e[5],e[6],e[7],e[8]]},create:n,createView:a,fromValues:i},Symbol.toStringTag,{value:"Module"}))},67593:function(e,t,r){r.d(t,{E:function(){return f},H:function(){return h}});var n=r(29439),i=r(22753),a=r(11873),s=r(88396),o=r(11186),l=(0,r(71353).c)(),u=(0,a.c)(),c=(0,a.c)(),d=(0,a.c)();function h(e,t,r){return(0,o.s)(l,t[0],t[1],1),(0,o.t)(l,l,(0,i.t)(u,r)),0===l[2]?(0,s.s)(e,l[0],l[1]):(0,s.s)(e,l[0]/l[2],l[1]/l[2])}function f(e,t,r){return v(c,t[0],t[1],t[2],t[3],t[4],t[5],t[6],t[7]),v(d,r[0],r[1],r[2],r[3],r[4],r[5],r[6],r[7]),(0,i.m)(e,(0,i.a)(c,c),d),0!==e[8]&&(e[0]/=e[8],e[1]/=e[8],e[2]/=e[8],e[3]/=e[8],e[4]/=e[8],e[5]/=e[8],e[6]/=e[8],e[7]/=e[8],e[8]/=e[8]),e}function v(e,t,r,a,s,c,d,h,f){(0,i.s)(e,t,a,c,r,s,d,1,1,1),(0,o.s)(l,h,f,1),(0,i.a)(u,e);var v=(0,o.t)(l,l,(0,i.t)(u,u)),p=(0,n.Z)(v,3),y=p[0],m=p[1],_=p[2];return(0,i.s)(u,y,0,0,0,m,0,0,0,_),(0,i.m)(e,u,e)}},59568:function(e,t,r){r.d(t,{L:function(){return y}});var n=r(15671),i=r(43144),a=r(60136),s=r(29388),o=r(27366),l=r(85015),u=r(92026),c=r(49861),d=(r(25243),r(63780),r(69912)),h=r(80885),f=r(52587),v=r(65156),p=r(47991),y=function(e){(0,a.Z)(r,e);var t=(0,s.Z)(r);function r(e){return(0,n.Z)(this,r),t.call(this,e)}return(0,i.Z)(r,[{key:"bounds",get:function(){var e=this.coords;return(0,u.Wi)(e)||(0,u.Wi)(e.extent)?null:(0,v.oJ)(e.extent)}},{key:"coords",get:function(){var e,t=null===(e=(0,u.Wg)(this.element.georeference))||void 0===e?void 0:e.coords;return(0,f.dz)(t,this.spatialReference).geometry}},{key:"normalizedCoords",get:function(){return h.Z.fromJSON((0,p.Ui)(this.coords))}},{key:"normalizedBounds",get:function(){var e=(0,u.pC)(this.normalizedCoords)?this.normalizedCoords.extent:null;return(0,u.pC)(e)?(0,v.oJ)(e):null}}]),r}(l.Z);(0,o._)([(0,c.Cb)()],y.prototype,"spatialReference",void 0),(0,o._)([(0,c.Cb)()],y.prototype,"element",void 0),(0,o._)([(0,c.Cb)()],y.prototype,"bounds",null),(0,o._)([(0,c.Cb)()],y.prototype,"coords",null),(0,o._)([(0,c.Cb)()],y.prototype,"normalizedCoords",null),(0,o._)([(0,c.Cb)()],y.prototype,"normalizedBounds",null),y=(0,o._)([(0,d.j)("esri.layers.support.MediaElementView")],y)},45139:function(e,t,r){r.r(t),r.d(t,{default:function(){return ue}});var n=r(29439),i=r(74165),a=r(15861),s=r(37762),o=r(15671),l=r(43144),u=r(11752),c=r(61120),d=r(60136),h=r(29388),f=r(27366),v=(r(59486),r(52639),r(94931),r(78451),r(98689),r(57823),r(32066),r(49018),r(34999),r(28189),r(9014),r(51508),r(40281)),p=(r(93169),r(32718)),y=r(77427),m=r(92026),_=r(66978),g=r(94172),w=r(49861),Z=(r(25243),r(63780),r(69912)),k=r(65156),C=r(34066),b=r(66504),R=r(59568),x=r(10064),E=(r(99346),r(76200),r(52522),r(35995),r(47191),r(41978),r(87422)),M=(r(3453),r(39484),r(80613)),T=(r(13594),r(151),r(84319),r(52120),r(8548)),S=(r(37825),r(49800)),V=(r(3667),r(84936),r(54815),r(10435),r(30575),r(41768),r(78020),r(44070)),A=(r(53634),r(51378)),W=r(45412),G=(r(64337),r(61441),r(86909),r(82386),r(16889)),q=(r(73271),r(21391),r(15245)),z=(r(10106),r(34052),r(53456),r(54711),r(62013),r(92841),r(23174),r(93985),r(13163),r(36207),r(98634),r(46228),r(78041),r(75409),r(77234),r(34035),r(26885),r(79347),r(83406),r(68860),r(49229),r(8229)),P=r(91340),D=(r(91908),r(14921),r(69610),r(5131),r(37995),r(73828),r(32344)),U=r(85269),O=r(98928),I=r(67593),L=r(11873),j=r(88396),B=r(6394),H=(0,L.c)(),Q=function(e){(0,d.Z)(r,e);var t=(0,h.Z)(r);function r(e){var n;return(0,o.Z)(this,r),(n=t.call(this)).elementView=e,n.isWrapAround=!1,n.perspectiveTransform=(0,B.a)(),n._vertices=new Float32Array(20),n._handles=[],n._handles.push((0,g.YP)((function(){return n.elementView.element.opacity}),(function(e){return n.opacity=e}),g.nn),(0,g.YP)((function(){return[n.elementView.coords]}),(function(){n.requestRender()}),g.nn),(0,g.gx)((function(){return n.elementView.element.loaded}),(function(){var e=n.elementView.element;n.ready(),"video"===e.type&&(0,m.pC)(e.content)&&n._handles.push((0,O.on)(e.content,"play",(function(){return n.requestRender()})))}),g.nn)),e.element.load().catch((function(t){p.Z.getLogger("esri.views.2d.layers.MediaLayerView2D").error(new x.Z("element-load-error","Element cannot be displayed",{element:e,error:t}))})),n}return(0,l.Z)(r,[{key:"destroy",value:function(){this._handles.forEach((function(e){return e.remove()})),this.texture=(0,m.M2)(this.texture)}},{key:"dvsMat3",get:function(){return this.parent.dvsMat3}},{key:"beforeRender",value:function(e){var t=e.context,n=this.elementView.element.content;if((0,m.pC)(n)){var i=n instanceof HTMLImageElement,a=n instanceof HTMLVideoElement,s=i?n.naturalWidth:a?n.videoWidth:n.width,o=i?n.naturalHeight:a?n.videoHeight:n.height;this._updatePerspectiveTransform(s,o),this.texture?a&&!n.paused&&(this.texture.setData(n),this.requestRender(),(t.type===S.zO.WEBGL2||(0,G.wt)(s)&&(0,G.wt)(o))&&this.texture.generateMipmap()):(this.texture=new A.x(t,{pixelFormat:T.VI.RGBA,dataType:T.Br.UNSIGNED_BYTE,samplingMode:T.cw.LINEAR,wrapMode:T.e8.CLAMP_TO_EDGE,width:s,height:o,preMultiplyAlpha:!0},n),(t.type===S.zO.WEBGL2||(0,G.wt)(s)&&(0,G.wt)(o))&&this.texture.generateMipmap(),a&&!n.paused&&this.requestRender())}(0,u.Z)((0,c.Z)(r.prototype),"beforeRender",this).call(this,e)}},{key:"_createTransforms",value:function(){return null}},{key:"updateDrawCoords",value:function(e,t){var r=this.elementView.coords;if(!(0,m.Wi)(r)){var i=(0,n.Z)(r.rings[0],4),a=i[0],s=i[1],o=i[2],l=i[3],u=this._vertices,c=e.x,d=e.y,h=0!==t;h?u.set([s[0]-c,s[1]-d,a[0]-c,a[1]-d,o[0]-c,o[1]-d,l[0]-c,l[1]-d,l[0]-c,l[1]-d,s[0]+t-c,s[1]-d,s[0]+t-c,s[1]-d,a[0]+t-c,a[1]-d,o[0]+t-c,o[1]-d,l[0]+t-c,l[1]-d]):u.set([s[0]-c,s[1]-d,a[0]-c,a[1]-d,o[0]-c,o[1]-d,l[0]-c,l[1]-d]),this.isWrapAround=h}}},{key:"getVAO",value:function(e,t,r){if((0,m.Wi)(this.elementView.coords))return null;var n=this._vertices;if(this._vao)this._geometryVbo.setData(n);else{this._geometryVbo=V.f.createVertex(e,T.l1.DYNAMIC_DRAW,n);var i=V.f.createVertex(e,T.l1.STATIC_DRAW,new Uint16Array([0,0,0,1,1,0,1,1,1,1,0,0,0,0,0,1,1,0,1,1]));this._vao=new W.U(e,r,t,{geometry:this._geometryVbo,tex:i})}return this._vao}},{key:"_updatePerspectiveTransform",value:function(e,t){var r=this._vertices;(0,I.E)(H,[0,0,e,0,0,t,e,t],[r[0],r[1],r[4],r[5],r[2],r[3],r[6],r[7]]),(0,j.s)(this.perspectiveTransform,H[6]/H[8]*e,H[7]/H[8]*t)}}]),r}(E.s),N=r(93433),F=r(17842),Y=r(22753),J=r(23588),K=r(92975),X=r(86226),$=r(62272),ee=function(e){(0,d.Z)(r,e);var t=(0,h.Z)(r);function r(){var e;return(0,o.Z)(this,r),(e=t.apply(this,arguments))._localOrigin=(0,F.vW)(0,0),e._viewStateId=-1,e._dvsMat3=(0,J.c)(),e.requiresDedicatedFBO=!1,e}return(0,l.Z)(r,[{key:"dvsMat3",get:function(){return this._dvsMat3}},{key:"beforeRender",value:function(e){this._updateMatrices(e),this._updateOverlays(e,this.children);var t,r=(0,s.Z)(this.children);try{for(r.s();!(t=r.n()).done;){t.value.beforeRender(e)}}catch(n){r.e(n)}finally{r.f()}}},{key:"prepareRenderPasses",value:function(e){var t=this,n=e.registerRenderPass({name:"overlay",brushes:[$.U.overlay],target:function(){return t.children},drawPhase:M.jx.MAP});return[].concat((0,N.Z)((0,u.Z)((0,c.Z)(r.prototype),"prepareRenderPasses",this).call(this,e)),[n])}},{key:"_updateMatrices",value:function(e){var t=e.state,r=t.id,n=t.size,i=t.pixelRatio,a=t.resolution,s=t.rotation,o=t.viewpoint,l=t.displayMat3;if(this._viewStateId!==r){var u=Math.PI/180*s,c=i*n[0],d=i*n[1],h=o.targetGeometry,f=h.x,v=h.y,p=(0,P.or)(f,t.spatialReference);this._localOrigin.x=p,this._localOrigin.y=v;var y=a*c,m=a*d,_=(0,Y.g)(this._dvsMat3);(0,Y.m)(_,_,l),(0,Y.h)(_,_,(0,q.f)(c/2,d/2)),(0,Y.d)(_,_,(0,z.f)(c/y,-d/m,1)),(0,Y.r)(_,_,-u),this._viewStateId=r}}},{key:"_updateOverlays",value:function(e,t){var r=e.state,i=r.rotation,a=r.spatialReference,o=r.worldScreenWidth,l=r.size,u=r.viewpoint,c=this._localOrigin,d=0,h=(0,K.C5)(a);if(h&&a.isWrappable){var f=l[0],v=l[1],p=180/Math.PI*i,y=Math.abs(Math.cos(p)),_=Math.abs(Math.sin(p)),g=Math.round(f*y+v*_),w=(0,n.Z)(h.valid,2),Z=w[0],k=w[1],C=(0,X.ut)(a),b=u.targetGeometry,R=b.x,x=[R,b.y],E=[0,0];r.toScreen(E,x);var M,T=[0,0];M=g>o?.5*o:.5*g;var S=Math.floor((R+.5*C)/C),V=Z+S*C,A=k+S*C,W=[E[0]+M,0];r.toMap(T,W),T[0]>A&&(d=C),W[0]=E[0]-M,r.toMap(T,W),T[0]<V&&(d=-C);var G,q=(0,s.Z)(t);try{for(q.s();!(G=q.n()).done;){var z=G.value,P=z.elementView.bounds;if(!(0,m.Wi)(P)){var D=(0,n.Z)(P,3),U=D[0],O=D[2];U<Z&&O>Z?z.updateDrawCoords(c,C):O>k&&U<k?z.updateDrawCoords(c,-C):z.updateDrawCoords(c,d)}}}catch(j){q.e(j)}finally{q.f()}}else{var I,L=(0,s.Z)(t);try{for(L.s();!(I=L.n()).done;){I.value.updateDrawCoords(c,d)}}catch(j){L.e(j)}finally{L.f()}}}}]),r}(r(64510).Z),te=r(95986),re=r(67581),ne=r(53866),ie=function(e){(0,d.Z)(r,e);var t=(0,h.Z)(r);function r(){var e;return(0,o.Z)(this,r),(e=t.apply(this,arguments))._overlayContainer=null,e._fetchQueue=null,e._tileStrategy=null,e._elementReferences=new Map,e._debugGraphicsView=null,e.layer=null,e.elements=new v.Z,e}return(0,l.Z)(r,[{key:"attach",value:function(){var e=this;this.addAttachHandles([(0,g.on)((function(){return e.layer.effectiveSource}),"refresh",(function(){var t,r=(0,s.Z)(e._tileStrategy.tiles);try{for(r.s();!(t=r.n()).done;){var n=t.value;e._updateTile(n)}}catch(i){r.e(i)}finally{r.f()}e.requestUpdate()})),(0,g.on)((function(){return e.layer.effectiveSource}),"change",(function(t){var r=t.element;return e._elementUpdateHandler(r)}))]),this._overlayContainer=new ee,this.container.addChild(this._overlayContainer),this._fetchQueue=new D.Z({tileInfoView:this.view.featuresTilingScheme,concurrency:10,process:function(t,r){return e._queryElements(t,r)}}),this._tileStrategy=new U.Z({cachePolicy:"purge",resampling:!0,acquireTile:function(t){return e._acquireTile(t)},releaseTile:function(t){return e._releaseTile(t)},tileInfoView:this.view.featuresTilingScheme}),this.requestUpdate()}},{key:"detach",value:function(){var e;this.elements.removeAll(),this._tileStrategy.destroy(),this._fetchQueue.destroy(),this._overlayContainer.removeAllChildren(),this.container.removeAllChildren(),this._elementReferences.clear(),null===(e=this._debugGraphicsView)||void 0===e||e.destroy()}},{key:"supportsSpatialReference",value:function(e){return!0}},{key:"moveStart",value:function(){this.requestUpdate()}},{key:"viewChange",value:function(){this.requestUpdate()}},{key:"moveEnd",value:function(){this.requestUpdate()}},{key:"update",value:function(e){var t;this._tileStrategy.update(e),null===(t=this._debugGraphicsView)||void 0===t||t.update(e)}},{key:"hitTest",value:function(){var e=(0,a.Z)((0,i.Z)().mark((function e(t,r){var n,a,o,l,u,c,d,h;return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n=[],a=t.normalize(),o=[a.x,a.y],l=(0,s.Z)(this._elementReferences.values());try{for(l.s();!(u=l.n()).done;)c=u.value.projectedElement,d=c.normalizedCoords,h=c.element,(0,m.pC)(d)&&(0,C.wP)(d.rings,o)&&n.push({type:"media",element:h,layer:this.layer,mapPoint:t})}catch(r){l.e(r)}finally{l.f()}return e.abrupt("return",n.reverse());case 4:case"end":return e.stop()}}),e,this)})));return function(t,r){return e.apply(this,arguments)}}()},{key:"canResume",value:function(){return null!=this.layer.source&&(0,u.Z)((0,c.Z)(r.prototype),"canResume",this).call(this)}},{key:"doRefresh",value:function(){var e=(0,a.Z)((0,i.Z)().mark((function e(){var t=this;return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:this._fetchQueue.reset(),this._tileStrategy.tiles.forEach((function(e){return t._updateTile(e)}));case 1:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"_acquireTile",value:function(e){var t=new le(e.clone());return this._updateTile(t),t}},{key:"_updateTile",value:function(e){var t=this;this.updatingHandles.addPromise(this._fetchQueue.push(e.key).then((function(r){var i=e.setElements(r),a=(0,n.Z)(i,2),s=a[0],o=a[1];t._referenceElements(e,s),t._dereferenceElements(e,o),t.requestUpdate()}),(function(e){(0,_.D_)(e)||p.Z.getLogger(t.declaredClass).error(e)})))}},{key:"_releaseTile",value:function(e){this._fetchQueue.abort(e.key.id),e.elements&&this._dereferenceElements(e,e.elements),this.requestUpdate()}},{key:"_queryElements",value:function(){var e=(0,a.Z)((0,i.Z)().mark((function e(t,r){var n,a;return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=this.layer.effectiveSource,!(0,m.Wi)(n)){e.next=3;break}return e.abrupt("return",[]);case 3:return this.view.featuresTilingScheme.getTileBounds(ae,t,!0),a=new ne.Z({xmin:ae[0],ymin:ae[1],xmax:ae[2],ymax:ae[3],spatialReference:this.view.spatialReference}),e.abrupt("return",n.queryElements(a,r));case 6:case"end":return e.stop()}}),e,this)})));return function(t,r){return e.apply(this,arguments)}}()},{key:"_referenceElements",value:function(e,t){var r=this.layer.source;if(!(0,m.Wi)(r)){var n,i=(0,s.Z)(t);try{for(i.s();!(n=i.n()).done;){var a=n.value;this._referenceElement(e,a)}}catch(o){i.e(o)}finally{i.f()}}}},{key:"_referenceElement",value:function(e,t){var r=this;(0,y.s1)(this._elementReferences,t.uid,(function(){var e=new R.L({element:t,spatialReference:r.view.spatialReference}),n=new Q(e);r._overlayContainer.addChild(n),r.elements.add(t);return{tiles:new Set,projectedElement:e,overlay:n,debugGraphic:null}})).tiles.add(e)}},{key:"_dereferenceElements",value:function(e,t){var r,n=(0,s.Z)(t);try{for(n.s();!(r=n.n()).done;){var i=r.value;this._dereferenceElement(e,i)}}catch(a){n.e(a)}finally{n.f()}}},{key:"_dereferenceElement",value:function(e,t){var r,n=this._elementReferences.get(t.uid);n.tiles.delete(e),n.tiles.size||(this._overlayContainer.removeChild(n.overlay),n.overlay.destroy(),n.projectedElement.destroy(),this._elementReferences.delete(t.uid),this.elements.remove(t),null===(r=this._debugGraphicsView)||void 0===r||r.graphics.remove(n.debugGraphic))}},{key:"_elementUpdateHandler",value:function(e){var t=this._elementReferences.get(e.uid);if(t){var r,n,i=t.projectedElement.normalizedCoords;if((0,m.Wi)(i))return this._overlayContainer.removeChild(t.overlay),t.overlay.destroy(),t.projectedElement.destroy(),this._elementReferences.delete(e.uid),this.elements.remove(e),void(null===(r=this._debugGraphicsView)||void 0===r||r.graphics.remove(t.debugGraphic));var a,o=[],l=[],u=(0,s.Z)(this._tileStrategy.tiles);try{for(u.s();!(a=u.n()).done;){var c=a.value,d=oe(this.view.featuresTilingScheme,c,i);t.tiles.has(c)?d||l.push(c):d&&o.push(c)}}catch(C){u.e(C)}finally{u.f()}for(var h=0,f=o;h<f.length;h++){var v=f[h];this._referenceElement(v,e)}for(var p=0,y=l;p<y.length;p++){var _=y[p];this._dereferenceElement(_,e)}(null===(n=t=this._elementReferences.get(e.uid))||void 0===n?void 0:n.debugGraphic)&&(t.debugGraphic.geometry=t.projectedElement.normalizedCoords,this._debugGraphicsView.graphicUpdateHandler({graphic:t.debugGraphic,property:"geometry"}))}else{var g=new R.L({element:e,spatialReference:this.view.spatialReference}).normalizedCoords;if((0,m.pC)(g)){var w,Z=(0,s.Z)(this._tileStrategy.tiles);try{for(Z.s();!(w=Z.n()).done;){var k=w.value;oe(this.view.featuresTilingScheme,k,g)&&this._referenceElement(k,e)}}catch(C){Z.e(C)}finally{Z.f()}}}}}]),r}((0,te.y)(re.Z));(0,f._)([(0,w.Cb)()],ie.prototype,"_fetchQueue",void 0),(0,f._)([(0,w.Cb)()],ie.prototype,"layer",void 0),(0,f._)([(0,w.Cb)({readOnly:!0})],ie.prototype,"elements",void 0),ie=(0,f._)([(0,Z.j)("esri.views.2d.layers.MediaLayerView2D")],ie);var ae=(0,k.Ue)(),se={xmin:0,ymin:0,xmax:0,ymax:0};function oe(e,t,r){return e.getTileBounds(ae,t.key,!0),se.xmin=ae[0],se.ymin=ae[1],se.xmax=ae[2],se.ymax=ae[3],(0,b.Nl)(se,r)}var le=function(){function e(t){(0,o.Z)(this,e),this.key=t,this.elements=null,this.isReady=!1,this.visible=!0}return(0,l.Z)(e,[{key:"setElements",value:function(e){var t=[],r=new Set(this.elements);this.elements=e;var n,i=(0,s.Z)(e);try{for(i.s();!(n=i.n()).done;){var a=n.value;r.has(a)?r.delete(a):t.push(a)}}catch(o){i.e(o)}finally{i.f()}return this.isReady=!0,[t,Array.from(r)]}},{key:"destroy",value:function(){}}]),e}(),ue=ie}}]);
//# sourceMappingURL=5139.ce0fe91f.chunk.js.map