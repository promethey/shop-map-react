{"version":3,"file":"static/js/5482.744d68b7.chunk.js","mappings":"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","sources":["../node_modules/@arcgis/core/views/3d/layers/i3s/PointCloudWorkerUtil.js","../node_modules/@arcgis/core/views/3d/layers/PointCloudWorker.js"],"sourcesContent":["/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.26/esri/copyright.txt for details.\n*/\nimport{isNone as e,isSome as o}from\"../../../../core/maybe.js\";import r from\"../../../../renderers/PointCloudClassBreaksRenderer.js\";import t from\"../../../../renderers/PointCloudStretchRenderer.js\";import l from\"../../../../renderers/PointCloudUniqueValueRenderer.js\";import{createGeometryIndexFromSchema as n,createTypedView as s,readBinaryAttribute as i}from\"./I3SBinaryReader.js\";import{decodeXYZ as u}from\"./LEPCC.js\";function f(e,o,n,s){const{rendererJSON:i,isRGBRenderer:u}=e;let f=null,c=null;if(o&&u)f=o;else if(o&&\"pointCloudUniqueValueRenderer\"===i?.type){c=l.fromJSON(i);const e=c.colorUniqueValueInfos;f=new Uint8Array(3*s);const r=b(c.fieldTransformType);for(let t=0;t<s;t++){const l=(r?r(o[t]):o[t])+\"\";for(let o=0;o<e.length;o++)if(e[o].values.includes(l)){f[3*t]=e[o].color.r,f[3*t+1]=e[o].color.g,f[3*t+2]=e[o].color.b;break}}}else if(o&&\"pointCloudStretchRenderer\"===i?.type){c=t.fromJSON(i);const e=c.stops;f=new Uint8Array(3*s);const r=b(c.fieldTransformType);for(let t=0;t<s;t++){const l=r?r(o[t]):o[t],n=e.length-1;if(l<e[0].value)f[3*t]=e[0].color.r,f[3*t+1]=e[0].color.g,f[3*t+2]=e[0].color.b;else if(l>=e[n].value)f[3*t]=e[n].color.r,f[3*t+1]=e[n].color.g,f[3*t+2]=e[n].color.b;else for(let o=1;o<e.length;o++)if(l<e[o].value){const r=(l-e[o-1].value)/(e[o].value-e[o-1].value);f[3*t]=e[o].color.r*r+e[o-1].color.r*(1-r),f[3*t+1]=e[o].color.g*r+e[o-1].color.g*(1-r),f[3*t+2]=e[o].color.b*r+e[o-1].color.b*(1-r);break}}}else if(o&&\"pointCloudClassBreaksRenderer\"===i?.type){c=r.fromJSON(i);const e=c.colorClassBreakInfos;f=new Uint8Array(3*s);const t=b(c.fieldTransformType);for(let r=0;r<s;r++){const l=t?t(o[r]):o[r];for(let o=0;o<e.length;o++)if(l>=e[o].minValue&&l<=e[o].maxValue){f[3*r]=e[o].color.r,f[3*r+1]=e[o].color.g,f[3*r+2]=e[o].color.b;break}}}else{f=new Uint8Array(3*s);for(let e=0;e<f.length;e++)f[e]=255}if(n&&c&&c.colorModulation){const e=c.colorModulation.minValue,o=c.colorModulation.maxValue,r=.3;for(let t=0;t<s;t++){const l=n[t],s=l>=o?1:l<=e?r:r+(1-r)*(l-e)/(o-e);f[3*t]=s*f[3*t],f[3*t+1]=s*f[3*t+1],f[3*t+2]=s*f[3*t+2]}}return f}function c(o,r){if(null==o.encoding||\"\"===o.encoding){const t=n(r,o);if(e(t.vertexAttributes.position))return;const l=s(r,t.vertexAttributes.position),i=t.header.fields,u=[i.offsetX,i.offsetY,i.offsetZ],f=[i.scaleX,i.scaleY,i.scaleZ],c=l.length/3,a=new Float64Array(3*c);for(let e=0;e<c;e++)a[3*e]=l[3*e]*f[0]+u[0],a[3*e+1]=l[3*e+1]*f[1]+u[1],a[3*e+2]=l[3*e+2]*f[2]+u[2];return a}if(\"lepcc-xyz\"===o.encoding)return u(r).result}function a(e,r,t){return o(e)&&e.attributeInfo.useElevation?r?d(r,t):null:o(e)&&e.attributeInfo.storageInfo?i(e.attributeInfo.storageInfo,e.buffer,t):null}function d(e,o){const r=new Float64Array(o);for(let t=0;t<o;t++)r[t]=e[3*t+2];return r}function m(e,o,r,t,l){const n=e.length/3;let s=0;for(let i=0;i<n;i++){let n=!0;for(let e=0;e<t.length&&n;e++){const{filterJSON:o}=t[e],r=l[e].values[i];switch(o.type){case\"pointCloudValueFilter\":{const e=\"exclude\"===o.mode;o.values.includes(r)===e&&(n=!1);break}case\"pointCloudBitfieldFilter\":{const e=p(o.requiredSetBits),t=p(o.requiredClearBits);(r&e)===e&&0==(r&t)||(n=!1);break}case\"pointCloudReturnFilter\":{const e=15&r,t=r>>>4&15,l=t>1,s=1===e,i=e===t;let u=!1;for(const r of o.includedReturns)if(\"last\"===r&&i||\"firstOfMany\"===r&&s&&l||\"lastOfMany\"===r&&i&&l||\"single\"===r&&!l){u=!0;break}u||(n=!1);break}}}n&&(r[s]=i,e[3*s]=e[3*i],e[3*s+1]=e[3*i+1],e[3*s+2]=e[3*i+2],o[3*s]=o[3*i],o[3*s+1]=o[3*i+1],o[3*s+2]=o[3*i+2],s++)}return s}function b(e){return null==e||\"none\"===e?null:\"low-four-bit\"===e?e=>15&e:\"high-four-bit\"===e?e=>(240&e)>>4:\"absolute-value\"===e?e=>Math.abs(e):\"modulo-ten\"===e?e=>e%10:null}function p(e){let o=0;for(const r of e||[])o|=1<<r;return o}export{d as elevationFromPositions,f as evaluateRenderer,m as filterInPlace,a as getAttributeValues,c as readGeometry};\n","/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.26/esri/copyright.txt for details.\n*/\nimport{isSome as t}from\"../../../core/maybe.js\";import{isArrayBuffer as r}from\"../../../core/typedArrayUtil.js\";import{c as e}from\"../../../chunks/quat.js\";import{c as a}from\"../../../chunks/quatf32.js\";import{q as o}from\"../../../chunks/vec3.js\";import{f,c as i}from\"../../../chunks/vec3f32.js\";import{projectBuffer as n}from\"../../../geometry/projection.js\";import s from\"../../../geometry/SpatialReference.js\";import{readGeometry as u,getAttributeValues as l,evaluateRenderer as b,filterInPlace as m}from\"./i3s/PointCloudWorkerUtil.js\";class c{transform(e){const a=this._transform(e),o=[a.points.buffer,a.rgb.buffer];t(a.pointIdFilterMap)&&o.push(a.pointIdFilterMap.buffer);for(const t of a.attributes)\"buffer\"in t.values&&r(t.values.buffer)&&t.values.buffer!==a.rgb.buffer&&o.push(t.values.buffer);return Promise.resolve({result:a,transferList:o})}_transform(r){const e=u(r.schema,r.geometryBuffer);let a=e.length/3,o=null;const f=[],i=l(r.primaryAttributeData,e,a);t(r.primaryAttributeData)&&i&&f.push({attributeInfo:r.primaryAttributeData.attributeInfo,values:i});const n=l(r.modulationAttributeData,e,a);t(r.modulationAttributeData)&&n&&f.push({attributeInfo:r.modulationAttributeData.attributeInfo,values:n});let c=b(r.rendererInfo,i,n,a);if(r.filterInfo&&r.filterInfo.length>0&&t(r.filterAttributesData)){const i=r.filterAttributesData.filter(t).map((t=>{const r=l(t,e,a),o={attributeInfo:t.attributeInfo,values:r};return f.push(o),o}));o=new Uint32Array(a),a=m(e,c,o,r.filterInfo,i)}for(const t of r.userAttributesData){const r=l(t,e,a);f.push({attributeInfo:t.attributeInfo,values:r})}3*a<c.length&&(c=new Uint8Array(c.buffer.slice(0,3*a))),this._applyElevationOffsetInPlace(e,a,r.elevationOffset);const p=this._transformCoordinates(e,a,r.obb,s.fromJSON(r.inSR),s.fromJSON(r.outSR));return{obb:r.obb,points:p,rgb:c,attributes:f,pointIdFilterMap:o}}_transformCoordinates(t,r,a,s,u){if(!n(t,s,0,t,u,0,r))throw new Error(\"Can't reproject\");const l=f(a.center[0],a.center[1],a.center[2]),b=i(),m=i();e(p,a.quaternion);const c=new Float32Array(3*r);for(let e=0;e<r;e++)b[0]=t[3*e]-l[0],b[1]=t[3*e+1]-l[1],b[2]=t[3*e+2]-l[2],o(m,b,p),a.halfSize[0]=Math.max(a.halfSize[0],Math.abs(m[0])),a.halfSize[1]=Math.max(a.halfSize[1],Math.abs(m[1])),a.halfSize[2]=Math.max(a.halfSize[2],Math.abs(m[2])),c[3*e]=b[0],c[3*e+1]=b[1],c[3*e+2]=b[2];return c}_applyElevationOffsetInPlace(t,r,e){if(0!==e)for(let a=0;a<r;a++)t[3*a+2]+=e}}const p=a();function h(){return new c}export{h as default};\n"],"names":["a","e","r","t","o","attributeInfo","useElevation","Float64Array","d","storageInfo","i","buffer","m","l","n","length","s","filterJSON","values","type","mode","includes","p","requiredSetBits","requiredClearBits","_step","u","_iterator","_createForOfIteratorHelper","includedReturns","done","value","err","f","b","Math","abs","_step2","_iterator2","c","_classCallCheck","_createClass","key","this","_transform","points","rgb","pointIdFilterMap","push","attributes","Promise","resolve","result","transferList","encoding","vertexAttributes","position","header","fields","offsetX","offsetY","offsetZ","scaleX","scaleY","scaleZ","schema","geometryBuffer","primaryAttributeData","modulationAttributeData","rendererJSON","isRGBRenderer","colorUniqueValueInfos","Uint8Array","fieldTransformType","color","g","stops","colorClassBreakInfos","minValue","maxValue","colorModulation","rendererInfo","filterInfo","filterAttributesData","filter","map","Uint32Array","userAttributesData","slice","_applyElevationOffsetInPlace","elevationOffset","_transformCoordinates","obb","inSR","outSR","Error","center","quaternion","Float32Array","halfSize","max","h"],"sourceRoot":""}