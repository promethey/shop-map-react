"use strict";(self.webpackChunkshop_map_react=self.webpackChunkshop_map_react||[]).push([[7957],{43244:function(e,t,i){i.d(t,{Z:function(){return u}});var r=i(37762),n=i(15671),s=i(43144),a=i(92026),u=function(){function e(t){(0,n.Z)(this,e),this.size=0,this._start=0,this.maxSize=t,this._buffer=new Array(t)}return(0,s.Z)(e,[{key:"entries",get:function(){return this._buffer}},{key:"enqueue",value:function(e){if(this.size===this.maxSize){var t=this._buffer[this._start];return this._buffer[this._start]=e,this._start=(this._start+1)%this.maxSize,t}return this._buffer[(this._start+this.size++)%this.maxSize]=e,null}},{key:"dequeue",value:function(){if(0===this.size)return null;var e=this._buffer[this._start];return this._buffer[this._start]=null,this.size--,this._start=(this._start+1)%this.maxSize,e}},{key:"peek",value:function(){return 0===this.size?null:this._buffer[this._start]}},{key:"find",value:function(e){if(0===this.size)return null;var t,i=(0,r.Z)(this._buffer);try{for(i.s();!(t=i.n()).done;){var n=t.value;if((0,a.pC)(n)&&e(n))return n}}catch(s){i.e(s)}finally{i.f()}return null}},{key:"clear",value:function(e){for(var t=this.dequeue();(0,a.pC)(t);)e&&e(t),t=this.dequeue()}}]),e}()},39383:function(e,t,i){i.d(t,{T:function(){return E}});var r=i(37762),n=i(74165),s=i(15861),a=i(15671),u=i(43144),o=i(11752),l=i(61120),f=i(60136),h=i(29388),c=i(66978),d=i(43e3),v=i(26885),_=i(55067),y=i(1413),p=i(92026),g=i(17842),k=i(68860),m=i(49229),b=i(84319),x=i(10435),w=i(98029),Z=i(90316);function C(e,t){var i=t.length;if(e<t[0].value||1===i)return t[0].size;for(var r=1;r<i;r++)if(e<t[r].value){var n=(e-t[r-1].value)/(t[r].value-t[r-1].value);return t[r-1].size+n*(t[r].size-t[r-1].size)}return t[i-1].size}var S=function(){function e(){(0,a.Z)(this,e),this.symbolLevels=[],this.vvColorValues=new Float32Array(8),this.vvColors=new Float32Array(32),this.vvOpacityValues=new Float32Array(8),this.vvOpacities=new Float32Array(8),this.vvSizeMinMaxValue=new Float32Array(4),this.outsideLabelsVisible=!1,this._vvMaterialParameters={vvSizeEnabled:!1,vvColorEnabled:!1,vvRotationEnabled:!1,vvRotationType:"geographic",vvOpacityEnabled:!1},this._technique=x.v}return(0,u.Z)(e,[{key:"getSizeVVFieldStops",value:function(e){var t=this._vvSizeFieldStops;if(t)switch(t.type){case"static":return t;case"level-dependent":return(0,p.Pt)(t.levels[e],(function(){var i=1/0,r=0;for(var n in t.levels){var s=parseFloat(n),a=Math.abs(e-s);a<i&&(i=a,r=s)}if(i===1/0)return{sizes:new Float32Array([0,0,0,0,0,0]),values:new Float32Array([0,0,0,0,0,0])};var u=Math.pow(2,(e-r)/2),o=(0,p.Wg)(t.levels[r]),l=new Float32Array(o.values);return l[2]*=u,l[3]*=u,{sizes:(0,p.Wg)(o.sizes),values:l}}));default:return}}},{key:"vvMaterialParameters",get:function(){return this._vvMaterialParameters}},{key:"update",value:function(e){(0,p.pC)(this._vvInfo)&&this._updateVisualVariables(this._vvInfo.vvRanges,e)}},{key:"setInfo",value:function(e,t,i){this._updateEffects(i),this._vvInfo=t,this._technique=(0,w.EJ)(e),this.rendererSchema=this._technique.createOrUpdateRendererSchema(this.rendererSchema,e)}},{key:"getVariation",value:function(){return(0,y.Z)((0,y.Z)({},this._technique.getVariation(this.rendererSchema)),{},{outsideLabelsVisible:this.outsideLabelsVisible,supportsTextureFloat:(0,Z.hc)("2d").supportsTextureFloat})}},{key:"getVariationHash",value:function(){return this._technique.getVariationHash(this.rendererSchema)<<1|(this.outsideLabelsVisible?1:0)}},{key:"_updateEffects",value:function(e){(0,p.pC)(e)?this.outsideLabelsVisible=e.excludedLabelsVisible:this.outsideLabelsVisible=!1}},{key:"_updateVisualVariables",value:function(e,t){var i=this._vvMaterialParameters;if(i.vvOpacityEnabled=!1,i.vvSizeEnabled=!1,i.vvColorEnabled=!1,i.vvRotationEnabled=!1,e){var r=e.size;if(r){if(i.vvSizeEnabled=!0,r.minMaxValue){var n,s,a=r.minMaxValue;if((0,b.$K)(a.minSize)&&(0,b.$K)(a.maxSize))if((0,b.hj)(a.minSize)&&(0,b.hj)(a.maxSize))n=(0,g.F2)(a.minSize),s=(0,g.F2)(a.maxSize);else{var u=t.scale;n=(0,g.F2)(C(u,a.minSize.stops)),s=(0,g.F2)(C(u,a.maxSize.stops))}this.vvSizeMinMaxValue.set([a.minDataValue,a.maxDataValue,n,s])}if(r.scaleStops&&(this.vvSizeScaleStopsValue=(0,g.F2)(C(t.scale,r.scaleStops.stops))),r.unitValue){var o=(0,k.c9)(t.spatialReference)/m.a[r.unitValue.unit];this.vvSizeUnitValueToPixelsRatio=o/t.resolution}r.fieldStops&&(this._vvSizeFieldStops=r.fieldStops)}var l=e.color;l&&(i.vvColorEnabled=!0,this.vvColorValues.set(l.values),this.vvColors.set(l.colors));var f=e.opacity;f&&(i.vvOpacityEnabled=!0,this.vvOpacityValues.set(f.values),this.vvOpacities.set(f.opacities));var h=e.rotation;h&&(i.vvRotationEnabled=!0,i.vvRotationType=h.type)}}}]),e}(),E=function(e){(0,f.Z)(i,e);var t=(0,h.Z)(i);function i(e){var r;return(0,a.Z)(this,i),(r=t.call(this,e))._rendererInfo=new S,r._materialItemsRequestQueue=new d.Z,r.attributeView=new v.H((function(){return r.onAttributeStoreUpdate()})),r}return(0,u.Z)(i,[{key:"destroy",value:function(){this.children.forEach((function(e){return e.destroy()})),this.removeAllChildren(),this.attributeView.destroy(),this._materialItemsRequestQueue.clear()}},{key:"setRendererInfo",value:function(e,t,i){this._rendererInfo.setInfo(e,t,i),this.requestRender()}},{key:"getMaterialItems",value:function(){var e=(0,s.Z)((0,n.Z)().mark((function e(t,i){var r;return(0,n.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t&&0!==t.length){e.next=2;break}return e.abrupt("return",[]);case 2:return r=(0,c.hh)(),e.abrupt("return",(this._materialItemsRequestQueue.push({items:t,abortOptions:i,resolver:r}),this.requestRender(),r.promise));case 4:case"end":return e.stop()}}),e,this)})));return function(t,i){return e.apply(this,arguments)}}()},{key:"doRender",value:function(e){if(e.context.capabilities.enable("textureFloat"),e.context.capabilities.enable("vao"),this._materialItemsRequestQueue.length>0)for(var t=this._materialItemsRequestQueue.pop();t;)this._processMaterialItemRequest(e,t),t=this._materialItemsRequestQueue.pop();(0,o.Z)((0,l.Z)(i.prototype),"doRender",this).call(this,e)}},{key:"renderChildren",value:function(e){var t,n=(0,r.Z)(this.children);try{for(n.s();!(t=n.n()).done;){t.value.commit(e)}}catch(s){n.e(s)}finally{n.f()}this._rendererInfo.update(e.state),(0,o.Z)((0,l.Z)(i.prototype),"renderChildren",this).call(this,e)}},{key:"updateTransforms",value:function(e){if(this.children.some((function(e){return e.hasData}))){var t,i=(0,r.Z)(this.children);try{for(i.s();!(t=i.n()).done;){t.value.setTransform(e)}}catch(n){i.e(n)}finally{i.f()}}}},{key:"createRenderParams",value:function(e){var t=(0,o.Z)((0,l.Z)(i.prototype),"createRenderParams",this).call(this,e);return t.rendererInfo=this._rendererInfo,t.attributeView=this.attributeView,t}},{key:"onAttributeStoreUpdate",value:function(){}},{key:"_processMaterialItemRequest",value:function(e,t){var i=this,r=t.items,n=t.abortOptions,s=t.resolver,a=e.painter,u=e.pixelRatio,o=r.map((function(e){return a.textureManager.rasterizeItem(e.symbol,u,e.glyphIds,n)}));Promise.all(o).then((function(e){if(i.stage){var t=e.map((function(e,t){return{id:r[t].id,mosaicItem:e}}));s.resolve(t)}else s.reject()}),s.reject)}}]),i}(_.Z)},39484:function(e,t,i){i.d(t,{Q:function(){return c},g:function(){return f}});var r=i(37762),n=i(15671),s=i(43144),a=i(93169),u=i(92026),o=i(70734),l=(0,a.Z)("esri-2d-log-allocations"),f=function(){function e(t,i){(0,n.Z)(this,e),this._array=t,this._pool=i}return(0,s.Z)(e,[{key:"array",get:function(){return this._array}},{key:"length",get:function(){return this._array.length}},{key:"expand",value:function(e){var t=this._pool.acquire(e);t.set(this._array),this._pool.release(this._array),this._array=t}},{key:"destroy",value:function(){this._pool.release(this._array)}},{key:"set",value:function(e,t){this._array.set(e._array,t)}},{key:"slice",value:function(){var t=this._pool.acquire(this._array.byteLength);return t.set(this._array),new e(t,this._pool)}}],[{key:"create",value:function(t,i){return new e(i.acquire(t),i)}}]),e}(),h=function(){function e(){(0,n.Z)(this,e),this._data=new ArrayBuffer(e.BYTE_LENGTH),this._freeList=new o.m({start:0,end:this._data.byteLength})}return(0,s.Z)(e,[{key:"buffer",get:function(){return this._data}},{key:"allocate",value:function(e){var t=this._freeList.firstFit(e);return(0,u.Wi)(t)?null:new Uint32Array(this._data,t,e/Uint32Array.BYTES_PER_ELEMENT)}},{key:"free",value:function(e){this._freeList.free(e.byteOffset,e.byteLength)}}],[{key:"BYTE_LENGTH",get:function(){return 64e6}}]),e}(),c=function(){function e(){(0,n.Z)(this,e),this._bytesAllocated=0,this._pages=[],this._pagesByBuffer=new Map,this._addPage()}return(0,s.Z)(e,[{key:"destroy",value:function(){this._pages=[],this._pagesByBuffer=null}},{key:"_bytesTotal",get:function(){return this._pages.length*h.BYTE_LENGTH}},{key:"acquire",value:function(e){if(this._bytesAllocated+=e,l&&console.log("Allocating ".concat(e,", (").concat(this._bytesAllocated," / ").concat(this._bytesTotal,")")),e>h.BYTE_LENGTH)return new Uint32Array(e/Uint32Array.BYTES_PER_ELEMENT);var t,i=(0,r.Z)(this._pages);try{for(i.s();!(t=i.n()).done;){var n=t.value.allocate(e);if((0,u.pC)(n))return n}}catch(s){i.e(s)}finally{i.f()}return(0,u.s3)(this._addPage().allocate(e),"Expected to allocate page")}},{key:"release",value:function(e){this._bytesAllocated-=e.byteLength,l&&console.log("Freeing ".concat(e.byteLength,", (").concat(this._bytesAllocated," / ").concat(this._bytesTotal,")"));var t=this._pagesByBuffer.get(e.buffer);t&&t.free(e)}},{key:"_addPage",value:function(){var e=new h;return this._pages.push(e),this._pagesByBuffer.set(e.buffer,e),e}}]),e}()},84328:function(e,t,i){i.d(t,{KS:function(){return l},PX:function(){return s},QS:function(){return h},_I:function(){return r},jL:function(){return o},nE:function(){return f},vs:function(){return u},xp:function(){return a}});var r=8388607,n=8388608,s=0,a=1,u=function(e){return(e&n)>>>23},o=function(e){return e&r},l=function(e){return u(e)===a?254:255};function f(e){return u(e)===a}function h(e,t){return((t?n:0)|e)>>>0}},55067:function(e,t,i){i.d(t,{Z:function(){return y}});var r=i(37762),n=i(15671),s=i(43144),a=i(11752),u=i(61120),o=i(60136),l=i(29388),f=i(93169),h=i(80613),c=i(64510),d=i(52424),v=i(40655),_=function(e,t){return e.key.level-t.key.level!=0?e.key.level-t.key.level:e.key.row-t.key.row!=0?e.key.row-t.key.row:e.key.col-t.key.col},y=function(e){(0,o.Z)(i,e);var t=(0,l.Z)(i);function i(e){var r;return(0,n.Z)(this,i),(r=t.call(this))._tileInfoView=e,r}return(0,s.Z)(i,[{key:"requiresDedicatedFBO",get:function(){return!1}},{key:"renderChildren",value:function(e){this.sortChildren(_),this.setStencilReference(e),(0,a.Z)((0,u.Z)(i.prototype),"renderChildren",this).call(this,e)}},{key:"createRenderParams",value:function(e){var t=e.state,r=(0,a.Z)((0,u.Z)(i.prototype),"createRenderParams",this).call(this,e);return r.requiredLevel=this._tileInfoView.getClosestInfoForScale(t.scale).level,r.displayLevel=this._tileInfoView.tileInfo.scaleToZoom(t.scale),r}},{key:"prepareRenderPasses",value:function(e){var t=this,r=(0,a.Z)((0,u.Z)(i.prototype),"prepareRenderPasses",this).call(this,e);return r.push(e.registerRenderPass({name:"stencil",brushes:[v.Z],drawPhase:h.jx.DEBUG|h.jx.MAP|h.jx.HIGHLIGHT,target:function(){return t.getStencilTarget()}})),(0,f.Z)("esri-tiles-debug")&&r.push(e.registerRenderPass({name:"tileInfo",brushes:[d.Z],drawPhase:h.jx.DEBUG,target:function(){return t.children}})),r}},{key:"getStencilTarget",value:function(){return this.children}},{key:"setStencilReference",value:function(e){var t,i=1,n=(0,r.Z)(this.children);try{for(n.s();!(t=n.n()).done;){t.value.stencilRef=i++}}catch(s){n.e(s)}finally{n.f()}}}]),i}(c.Z)},70734:function(e,t,i){i.d(t,{a:function(){return u},m:function(){return o}});var r=i(74165),n=i(15671),s=i(43144),a=i(92026),u=function(){function e(t){if((0,n.Z)(this,e),this.next=null,Array.isArray(t)){this.data=t[0];for(var i=this,r=1;r<t.length;r++)i.next=new e([t[r]]),i=i.next}else this.data=t}return(0,s.Z)(e,[{key:"values",value:(0,r.Z)().mark((function e(){var t;return(0,r.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t=this;case 1:if(!t){e.next=7;break}return e.next=4,t.data;case 4:t=t.next;case 5:e.next=1;break;case 7:case"end":return e.stop()}}),e,this)}))},{key:"forEach",value:function(e){for(var t=this;t;)e(t.data),t=t.next}},{key:"find",value:function(e){var t;return e(this.data)?this:null===(t=this.next)||void 0===t?void 0:t.find(e)}},{key:"max",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this,i=e(this.data)>e(t.data)?this:t;return this.next?this.next.max(e,i):i}},{key:"remove",value:function(e){var t,i,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;return this===e?r?(r.next=this.next,r):this.next:null!==(t=null===(i=this.next)||void 0===i?void 0:i.remove(e,this))&&void 0!==t?t:null}},{key:"last",get:function(){return this.next?this.next.last:this}}]),e}(),o=function(){function e(t){(0,n.Z)(this,e),this._head=null,(0,a.Wi)(t)||(this._head=new u(t))}return(0,s.Z)(e,[{key:"head",get:function(){return this._head}},{key:"maxAvailableSpace",value:function(){if((0,a.Wi)(this._head))return 0;var e=this._head.max((function(e){return e.end-e.start}));return e.data.end-e.data.start}},{key:"firstFit",value:function(e){if((0,a.Wi)(this._head))return null;for(var t=null,i=this._head;i;){var r=i.data.end-i.data.start;if(r===e)return t?t.next=i.next:this._head=i.next,i.data.start;if(r>e){var n=i.data.start;return i.data.start+=e,n}t=i,i=i.next}return null}},{key:"free",value:function(e,t){var i=e+t;if((0,a.Wi)(this._head)){var r=new u({start:e,end:i});this._head=r}else{if(i<=this._head.data.start){if(i===this._head.data.start)return void(this._head.data.start-=t);var n=new u({start:e,end:i});return n.next=this._head,void(this._head=n)}for(var s=this._head,o=s.next;o;){if(o.data.start>=i){if(s.data.end===e){if(s.data.end+=t,s.data.end===o.data.start){var l=o.data.end-o.data.start;return s.data.end+=l,void(s.next=o.next)}return}if(o.data.start===i)return void(o.data.start-=t);var f=new u({start:e,end:i});return f.next=s.next,void(s.next=f)}s=o,o=o.next}if(e!==s.data.end){var h=new u({start:e,end:i});s.next=h}else s.data.end+=t}}}]),e}()},64668:function(e,t,i){i.d(t,{J:function(){return n},g:function(){return r}});var r=function(e,t){return e&&function(){for(var e=arguments.length,i=new Array(e),r=0;r<e;r++)i[r]=arguments[r];return t.warn.apply(t,["DEBUG:"].concat(i))}||function(){return null}},n=!1},40639:function(e,t,i){i.d(t,{Z:function(){return c}});var r=i(15671),n=i(43144),s=i(60136),a=i(29388),u=i(27366),o=i(41691),l=i(49861),f=(i(25243),i(63780),i(69912)),h=function(e){(0,s.Z)(i,e);var t=(0,a.Z)(i);function i(e){var n;return(0,r.Z)(this,i),(n=t.call(this,e)).tiles=new Map,n}return(0,n.Z)(i,[{key:"destroy",value:function(){this.tiles.clear(),this.layer=this.layerView=this.tileInfoView=this.tiles=null}},{key:"updating",get:function(){return this.isUpdating()}},{key:"acquireTile",value:function(e){var t=this,i=this.createTile(e);return i.once("isReady",(function(){return t.notifyChange("updating")})),this.tiles.set(e.id,i),i}},{key:"forceAttributeTextureUpload",value:function(){}},{key:"forEachTile",value:function(e){this.tiles.forEach(e)}},{key:"releaseTile",value:function(e){this.tiles.delete(e.key.id),this.disposeTile(e)}},{key:"isUpdating",value:function(){var e=!0;return this.tiles.forEach((function(t){e=e&&t.isReady})),!e}},{key:"setHighlight",value:function(){}},{key:"invalidateLabels",value:function(){}},{key:"requestUpdate",value:function(){this.layerView.requestUpdate()}}]),i}(o.r);(0,u._)([(0,l.Cb)()],h.prototype,"layer",void 0),(0,u._)([(0,l.Cb)()],h.prototype,"layerView",void 0),(0,u._)([(0,l.Cb)()],h.prototype,"tileInfoView",void 0),(0,u._)([(0,l.Cb)()],h.prototype,"updating",null);var c=h=(0,u._)([(0,f.j)("esri.views.2d.layers.features.tileRenderers.BaseTileRenderer")],h)},47497:function(e,t,i){i.r(t),i.d(t,{default:function(){return G}});var r=i(74165),n=i(15861),s=i(15671),a=i(43144),u=i(11752),o=i(61120),l=i(60136),f=i(29388),h=i(27366),c=i(93169),d=i(92026),v=i(66978),_=(i(32718),i(25243),i(63780),i(10064),i(69912)),y=i(65156),p=i(37762),g=i(43244),k=i(11245),m=i(80613),b=i(84319),x=i(98774),w=4294967296,Z=function(){function e(t){(0,s.Z)(this,e),this._savedCursor=null,this._savedOffset=null,this._head=t,this._cursor=t}return(0,a.Z)(e,[{key:"id",get:function(){return this._cursor.id}},{key:"baseZoom",get:function(){return this._cursor.baseZoom}},{key:"anchorX",get:function(){return this._cursor.anchorX}},{key:"anchorY",get:function(){return this._cursor.anchorY}},{key:"directionX",get:function(){return this._cursor.directionX}},{key:"directionY",get:function(){return this._cursor.directionY}},{key:"size",get:function(){return this._cursor.size}},{key:"materialKey",get:function(){return this._cursor.materialKey}},{key:"boundsCount",get:function(){return this._cursor.boundsCount}},{key:"computedMinZoom",value:function(){return this._cursor.computedMinZoom()}},{key:"setComputedMinZoom",value:function(e){return this._cursor.setComputedMinZoom(e)}},{key:"boundsComputedAnchorX",value:function(e){return this._cursor.boundsComputedAnchorX(e)}},{key:"boundsComputedAnchorY",value:function(e){return this._cursor.boundsComputedAnchorY(e)}},{key:"setBoundsComputedAnchorX",value:function(e,t){return this._cursor.setBoundsComputedAnchorX(e,t)}},{key:"setBoundsComputedAnchorY",value:function(e,t){return this._cursor.setBoundsComputedAnchorY(e,t)}},{key:"boundsX",value:function(e){return this._cursor.boundsX(e)}},{key:"boundsY",value:function(e){return this._cursor.boundsY(e)}},{key:"boundsWidth",value:function(e){return this._cursor.boundsWidth(e)}},{key:"boundsHeight",value:function(e){return this._cursor.boundsHeight(e)}},{key:"link",value:function(e){if((0,d.pC)(e._head))return this._cursor.link(e._head)}},{key:"getCursor",value:function(){return this.copy()}},{key:"copy",value:function(){var t,i=new e(null===(t=this._head)||void 0===t?void 0:t.copy());if(!i._head)return i;for(var r=i._head,n=i._head._link;n;)r._link=n.copy(),n=(r=n)._link;return i}},{key:"peekId",value:function(){var e;return null!==(e=this._cursor.peekId())&&void 0!==e?e:this._cursor._link.peekId()}},{key:"nextId",value:function(){for(var e=this.id;e===this.id;)if(!this.next())return!1;return!0}},{key:"save",value:function(){this._savedCursor=this._cursor,this._savedOffset=this._cursor._offset}},{key:"restore",value:function(){this._savedCursor&&(this._cursor=this._savedCursor),null!=this._savedOffset&&(this._cursor._offset=this._savedOffset)}},{key:"next",value:function(){if(!this._cursor)return!1;if(!this._cursor.next()){if(!this._cursor._link)return!1;this._cursor=this._cursor._link,this._cursor._offset=0}return!0}},{key:"lookup",value:function(e){for(this._cursor=this._head;this._cursor&&!this._cursor.lookup(e);){if(!this._cursor._link)return!1;this._cursor=this._cursor._link}return!!this._cursor}},{key:"delete",value:function(e){for(var t=this._head,i=null;t;){if(t.delete(e))return t.isEmpty()&&(0,d.pC)(i)&&(i._link=t._link),!0;i=t,t=t._link}return!1}}],[{key:"from",value:function(t){return new e(C.from(new Float32Array(t)))}}]),e}(),C=function(){function e(t){(0,s.Z)(this,e),this._offset=-1,this._link=null,this._count=0,this._deletedCount=0,this._offsets={instance:null},this._buffer=t}return(0,a.Z)(e,[{key:"isEmpty",value:function(){return this._deletedCount===this.count}},{key:"count",get:function(){return this._count||(this._count=this._computeCount()),this._count}},{key:"id",get:function(){return this._buffer[this._offset+0]},set:function(e){this._buffer[this._offset+0]=e}},{key:"baseZoom",get:function(){return this._buffer[this._offset+1]}},{key:"anchorX",get:function(){return this._buffer[this._offset+2]}},{key:"anchorY",get:function(){return this._buffer[this._offset+3]}},{key:"directionX",get:function(){return this._buffer[this._offset+4]}},{key:"directionY",get:function(){return this._buffer[this._offset+5]}},{key:"size",get:function(){return this._buffer[this._offset+6]}},{key:"materialKey",get:function(){return this._buffer[this._offset+7]}},{key:"computedMinZoom",value:function(){return this._buffer[this._offset+8]}},{key:"setComputedMinZoom",value:function(e){this._buffer[this._offset+8]=e}},{key:"boundsCount",get:function(){return this._buffer[this._offset+9]}},{key:"boundsComputedAnchorX",value:function(e){return this._buffer[this._offset+10+6*e+0]}},{key:"boundsComputedAnchorY",value:function(e){return this._buffer[this._offset+10+6*e+1]}},{key:"setBoundsComputedAnchorX",value:function(e,t){this._buffer[this._offset+10+6*e+0]=t}},{key:"setBoundsComputedAnchorY",value:function(e,t){this._buffer[this._offset+10+6*e+1]=t}},{key:"boundsX",value:function(e){return this._buffer[this._offset+10+6*e+2]}},{key:"boundsY",value:function(e){return this._buffer[this._offset+10+6*e+3]}},{key:"boundsWidth",value:function(e){return this._buffer[this._offset+10+6*e+4]}},{key:"boundsHeight",value:function(e){return this._buffer[this._offset+10+6*e+5]}},{key:"link",value:function(e){for(var t=this;t._link;)t=t._link;t._link=e}},{key:"getCursor",value:function(){return this.copy()}},{key:"copy",value:function(){var t=new e(this._buffer);return t._link=this._link,t._offset=this._offset,t._deletedCount=this._deletedCount,t._offsets=this._offsets,t._count=this._count,t}},{key:"peekId",value:function(){var e=this._offset+10+6*this.boundsCount+0;return e>=this._buffer.length?0:this._buffer[e]}},{key:"next",value:function(){for(var e=0;this._offset<this._buffer.length&&e++<100&&(-1===this._offset?this._offset=0:this._offset+=10+6*this.boundsCount,this.id===w););return this.id!==w&&this._offset<this._buffer.length}},{key:"delete",value:function(e){var t=this._offset,i=this.lookup(e);if(i)for(this.id=4294967295,++this._deletedCount;this.next()&&this.id===e;)this.id=4294967295,++this._deletedCount;return this._offset=t,i}},{key:"lookup",value:function(e){var t=this._offset;if((0,d.Wi)(this._offsets.instance)){this._offsets.instance=new Map;var i=this.copy();i._offset=-1;for(var r=0;i.next();)i.id!==r&&(this._offsets.instance.set(i.id,i._offset),r=i.id)}return!!this._offsets.instance.has(e)&&(this._offset=this._offsets.instance.get(e),this.id!==w||(this._offset=t,!1))}},{key:"_computeCount",value:function(){var e=this._offset,t=0;for(this._offset=-1;this.next();)t++;return this._offset=e,t}}],[{key:"from",value:function(t){return new e(new Float32Array(t))}}]),e}(),S=i(29439),E=i(70734),V=function(){function e(t,i,r,n,a){(0,s.Z)(this,e),this.target=t,this.geometryType=i,this.materialKey=r,this.indexFrom=n,this.indexCount=a}return(0,a.Z)(e,[{key:"indexEnd",get:function(){return this.indexFrom+this.indexCount}},{key:"extend",value:function(e){this.indexCount+=e}}]),e}(),T=function(){function e(t,i){(0,s.Z)(this,e),this.geometryType=0,this._target=t,this.geometryType=i}return(0,a.Z)(e,[{key:"addRecord",value:function(e){var t=this._target,i=this.geometryType,r=e.materialKey,n=e.indexFrom,s=e.indexCount,a=e.vertexFrom,u=e.vertexCount;if(s||(n=a,s=u),(0,d.Wi)(this._head)){var o=new V(t,i,r,n,s);this._head=new E.a(o)}else{for(var l=null,f=this._head;f;){if(n<f.data.indexFrom)return this._insert(r,n,s,l,f);l=f,f=f.next}this._insert(r,n,s,l,null)}}},{key:"forEach",value:function(e){(0,d.pC)(this._head)&&this._head.forEach(e)}},{key:"infos",value:(0,r.Z)().mark((function e(){var t,i,n;return(0,r.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(0,d.pC)(this._head)){e.next=18;break}t=(0,p.Z)(this._head.values()),e.prev=2,t.s();case 4:if((i=t.n()).done){e.next=10;break}return n=i.value,e.next=8,n;case 8:e.next=4;break;case 10:e.next=15;break;case 12:e.prev=12,e.t0=e.catch(2),t.e(e.t0);case 15:return e.prev=15,t.f(),e.finish(15);case 18:case"end":return e.stop()}}),e,this,[[2,12,15,18]])}))},{key:"_insert",value:function(e,t,i,r,n){if((0,d.Wi)(r)&&(0,d.Wi)(n)){var s=new V(this._target,this.geometryType,e,t,i);this._head=new E.a(s)}return(0,d.Wi)(r)&&(0,d.pC)(n)?this._insertAtHead(e,t,i,n):(0,d.pC)(r)&&(0,d.Wi)(n)?this._insertAtEnd(e,t,i,r):(0,d.pC)(r)&&(0,d.pC)(n)?this._insertAtMiddle(e,t,i,r,n):void 0}},{key:"_insertAtHead",value:function(e,t,i,r){var n=t+i;if(e===r.data.materialKey&&n===r.data.indexFrom)r.data.indexFrom=t,r.data.indexCount+=i;else{var s=new V(this._target,this.geometryType,e,t,i);this._head=new E.a(s),this._head.next=r}}},{key:"_insertAtEnd",value:function(e,t,i,r){if(r.data.materialKey===e&&r.data.indexEnd===t)r.data.indexCount+=i;else{var n=new V(this._target,this.geometryType,e,t,i),s=new E.a(n);r.next=s}}},{key:"_insertAtMiddle",value:function(e,t,i,r,n){var s=t+i;if(r.data.materialKey===e&&r.data.indexEnd===t)r.data.indexCount+=i,r.data.materialKey===n.data.materialKey&&r.data.indexEnd===n.data.indexFrom&&(r.data.indexCount+=n.data.indexCount,r.next=n.next);else if(e===n.data.materialKey&&s===n.data.indexFrom)n.data.indexFrom=t,n.data.indexCount+=i;else{var a=new V(this._target,this.geometryType,e,t,i),u=new E.a(a);r.next=u,u.next=n}}}],[{key:"from",value:function(t,i,r,n){var s=new e(t,i);if((0,d.pC)(n)){var a,u=(0,p.Z)(n);try{for(u.s();!(a=u.n()).done;){var o=a.value;r.seekIndex(o),s.addRecord(r)}}catch(l){u.e(l)}finally{u.f()}}else for(;r.next();)s.addRecord(r);return s}}]),e}(),I=i(39484),R=i(44070),B=i(8548),A=function(){function e(t,i,r,n){(0,s.Z)(this,e);var a=I.g.create(i*r*Uint32Array.BYTES_PER_ELEMENT,n);this.size=i,this.strideInt=r,this.bufferType=t,this.dirty={start:1/0,end:0},this._gpu=null,this._cpu=a,this.clear()}return(0,a.Z)(e,[{key:"elementSize",get:function(){return this._cpu.length/this.strideInt}},{key:"invalidated",get:function(){return this.bufferSize>0&&!this._gpu}},{key:"invalidatedComputeBuffer",get:function(){return this.bufferSize>0&&!this._gpuComputeTriangles}},{key:"invalidate",value:function(){this._invalidateTriangleBuffer(),(0,d.yw)(this._gpu,(function(e){return e.dispose()})),this._gpu=null}},{key:"_invalidateTriangleBuffer",value:function(){(0,d.yw)(this._gpuComputeTriangles,(function(e){return e.dispose()})),this._gpuComputeTriangles=null}},{key:"destroy",value:function(){(0,d.yw)(this._gpu,(function(e){return e.dispose()})),(0,d.yw)(this._gpuComputeTriangles,(function(e){return e.dispose()})),(0,d.yw)(this._cpu,(function(e){return e.destroy()})),(0,d.yw)(this._cpu2,(function(e){return e.destroy()}))}},{key:"clear",value:function(){this.dirty.start=1/0,this.dirty.end=0,this.freeList=new E.m({start:0,end:this._cpu.length/this.strideInt}),this.fillPointer=0}},{key:"ensure",value:function(e){if(!(this.maxAvailableSpace()>=e)&&e*this.strideInt>this._cpu.length-this.fillPointer){this.invalidate();var t=this._cpu.length/this.strideInt,i=Math.round(1.25*(t+e)),r=i*this.strideInt;this._cpu.expand(r*Uint32Array.BYTES_PER_ELEMENT),this.freeList.free(t,i-t)}}},{key:"set",value:function(e,t){this._cpu.array[e]!==t&&(this._cpu.array[e]=t,this.dirty.start=Math.min(e,this.dirty.start),this.dirty.end=Math.max(e,this.dirty.end))}},{key:"getGPUBuffer",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(!this.bufferSize)return null;if(t){if("index"!==this.bufferType)throw new Error("Tired to get triangle buffer, but target is not an index buffer");return(0,d.Wi)(this._gpuComputeTriangles)&&(this._gpuComputeTriangles=this._createComputeBuffer(e)),this._gpuComputeTriangles}return(0,d.Wi)(this._gpu)&&(this._gpu=this._createBuffer(e)),this._gpu}},{key:"getCPUBuffer",value:function(){if(!this._cpu2){var e=this._cpu.slice();this._cpu2=e}return this._cpu2.length!==this._cpu.length&&this._cpu2.expand(this._cpu.length*this._cpu.array.BYTES_PER_ELEMENT),this._cpu2.set(this._cpu),this._cpu2}},{key:"bufferSize",get:function(){return this._cpu.length/this.strideInt}},{key:"maxAvailableSpace",value:function(){return this.freeList.maxAvailableSpace()}},{key:"insert",value:function(e,t,i,r){var n=i*this.strideInt;if(!n)return 0;var s=t*this.strideInt*Uint32Array.BYTES_PER_ELEMENT,a=new Uint32Array(e,s,n),u=(0,d.s3)(this.freeList.firstFit(i),"First fit region must be defined")*this.strideInt,o=n,l=u/this.strideInt-t;if(0!==r)for(var f=0;f<a.length;f++)a[f]+=r;return this._cpu.array.set(a,u),this.dirty.start=Math.min(this.dirty.start,u),this.dirty.end=Math.max(this.dirty.end,u+o),this.fillPointer=Math.max(this.fillPointer,u+o),l}},{key:"free",value:function(e,t,i){var r=e*this.strideInt,n=(e+t)*this.strideInt;if(!0===i)for(var s=e;s!==e+t;s++)this._cpu.array[s*this.strideInt]=2147450879;this.dirty.start=Math.min(this.dirty.start,r),this.dirty.end=Math.max(this.dirty.end,n),this.freeList.free(e,t)}},{key:"upload",value:function(){if(this.dirty.end){if(this._invalidateTriangleBuffer(),(0,d.Wi)(this._gpu))return this.dirty.start=1/0,void(this.dirty.end=0);this._gpu.setSubData(this._cpu.array,this.dirty.start,this.dirty.start,this.dirty.end),this.dirty.start=1/0,this.dirty.end=0}}},{key:"_createBuffer",value:function(e){var t=B.l1.DYNAMIC_DRAW;return"index"===this.bufferType?R.f.createIndex(e,t,this._cpu.array):R.f.createVertex(e,t,this._cpu.array)}},{key:"_createComputeBuffer",value:function(e){for(var t=B.l1.DYNAMIC_DRAW,i=new Uint32Array(this.fillPointer/3),r=0;r<this.fillPointer;r+=3)i[r/3]=this._cpu.array[r];return R.f.createIndex(e,t,i)}}]),e}(),U=i(50477),z=i(45412),L=function(){function e(t,i){(0,s.Z)(this,e),this._vaos=new Map,this._indicesInvalid=!1,this.geometryType=t,this._stage=i}return(0,a.Z)(e,[{key:"destroy",value:function(){var e,t=(0,p.Z)(this._vaos);try{for(t.s();!(e=t.n()).done;){var i=(0,S.Z)(e.value,2),r=(i[0],i[1]);(0,d.pC)(r)&&r.dispose(!1)}}catch(n){t.e(n)}finally{t.f()}this._indexBuffer=(0,d.SC)(this._indexBuffer),this._vertexBuffer=(0,d.SC)(this._vertexBuffer)}},{key:"insert",value:function(e,t,i){if(e.records.byteLength){var r=e.stride;if(this._vertexBuffer&&this._indexBuffer){var n=e.indices.byteLength/4,s=e.vertices.byteLength/r;this._indexBuffer.ensure(n),this._vertexBuffer.ensure(s);var a=e.vertices,u=e.indices,o=U.$.from(e.records),l=this._vertexBuffer.insert(a,0,a.byteLength/r,0),f=this._indexBuffer.insert(u,0,u.byteLength/4,l);if(o.forEach((function(e){e.indexFrom+=f,e.vertexFrom+=l})),(0,d.s3)(this._records,"Expected records to be defined").link(o),t)this._indicesInvalid=!0;else if(this._displayList)for(var h=o.getCursor();h.next();)this._displayList.addRecord(h)}else{var c=e.indices.byteLength/4,v=e.vertices.byteLength/r,_=r/Uint32Array.BYTES_PER_ELEMENT,y=this._stage.bufferPool;this._records=U.$.from(e.records),this._indexBuffer=new A("index",c,1,y),this._vertexBuffer=new A("vertex",v,_,y),this._indexBuffer.insert(e.indices,0,e.indices.byteLength/4,0),this._vertexBuffer.insert(e.vertices,0,e.vertices.byteLength/r,0),t&&(this._indicesInvalid=!0)}}}},{key:"remove",value:function(e){if(!(0,d.Wi)(this._records)){var t,i=(0,p.Z)(e);try{for(i.s();!(t=i.n()).done;){var r=t.value,n=this._records.getCursor();if(n.lookup(r)){for(var s=n.indexFrom,a=n.vertexFrom,u=n.indexCount,o=n.vertexCount;n.next()&&n.id===r;)u+=n.indexCount,o+=n.vertexCount;this._indexBuffer.free(s,u),this._vertexBuffer.free(a,o,!0),this._records.delete(r)}}}catch(l){i.e(l)}finally{i.f()}}}},{key:"getVAO",value:function(e,t,i,r){if(!this._vertexBuffer||!this._indexBuffer||(0,d.Wi)(this._records)||!this._vertexBuffer.bufferSize)return null;var n=r?1:0,s=this._vaos.get(n);(this._vertexBuffer.invalidated||this._indexBuffer.invalidated||r&&this._indexBuffer.invalidatedComputeBuffer)&&((0,d.yw)(s,(function(e){return e.dispose(!1)})),s=null),this._vertexBuffer.upload(),this._indexBuffer.upload();var a=this._indexBuffer.getGPUBuffer(e,1===n),u=this._vertexBuffer.getGPUBuffer(e);return s||(s=new z.U(e,i,t,{geometry:u},a),this._vaos.set(n,s)),s}},{key:"forEachCommand",value:function(e){if(!(0,d.Wi)(this._records)){if(this._sortIndices(this._records),!this._displayList){var t=this._cursorIndexOrder;this._displayList=T.from(this,this.geometryType,this._records.getCursor(),t)}this._displayList.forEach(e)}}},{key:"_sortIndices",value:function(e){var t=!!this._indexBuffer.bufferSize;if(this._indicesInvalid){this._indicesInvalid=!1;for(var i=0,r=e.getCursor(),n=[],s=[],a=[];r.next();)s.push(r.index),a.push(r.sortKey),n.push(r.id);s.sort((function(e,t){var i=a[t],r=a[e];return r===i?n[t]-n[e]:i-r}));for(var u=e.getCursor(),o=t?this._indexBuffer.getCPUBuffer():this._vertexBuffer.getCPUBuffer(),l=0,f=s;l<f.length;l++){var h=f[l];if(!u.seekIndex(h))throw new Error("Expected to find index");if(t){var c=u.indexFrom,d=u.indexCount;u.indexFrom=i;for(var v=0;v<d;v++)this._indexBuffer.set(i++,o.array[c+v])}else{var _=u.vertexFrom,y=u.vertexCount,p=this._vertexBuffer.strideInt,g=_*p,k=g+y*p;u.vertexFrom=i/p;for(var m=g;m<k;m++)this._vertexBuffer.set(i++,o.array[m])}}this._cursorIndexOrder=s,this._displayList=null}}}]),e}(),M=0,P=function(e){(0,l.Z)(i,e);var t=(0,f.Z)(i);function i(e,r,n,a,u,o){var l;return(0,s.Z)(this,i),(l=t.call(this,e,r,n,a)).instanceId=M++,l.patchCount=0,l._renderState={current:{geometry:new Map,metrics:null},next:null,swap:!1,swapFrames:0,locked:!1},l._patches=new g.Z(100),l._bufferPatches=new g.Z(100),l._lastCommitTime=0,l.transforms.labelMat2d=(0,k.c)(),l._store=u,l._requestLabelUpdate=o,l}return(0,a.Z)(i,[{key:"destroy",value:function(){(0,u.Z)((0,o.Z)(i.prototype),"destroy",this).call(this),this._renderState.current.geometry.forEach((function(e){return e.destroy()})),(0,d.pC)(this._renderState.next)&&this._renderState.next.geometry.forEach((function(e){return e.destroy()})),this._renderState.current=null,this._renderState.next=null}},{key:"labelMetrics",get:function(){return this._renderState.current.metrics}},{key:"hasData",get:function(){return!!this._renderState.current.geometry.size}},{key:"getGeometry",value:function(e){return this._renderState.current.geometry.get(e)}},{key:"patch",value:function(e,t){this.patchCount++,e.clear&&this._patches.size>=50&&this._dropPatches();var i=e,r=i.addOrUpdate&&this.key.id!==i.addOrUpdate.tileKeyOrigin;t&&r?this._bufferPatches.enqueue(i):(i.sort=i.sort&&!t,this._patches.enqueue(i)),this.requestRender()}},{key:"commit",value:function(e){if(this._lastCommitTime!==e.time){this._lastCommitTime=e.time;for(var t=0;t<4;t++)this._updateMesh(),this.isReady&&this._updateBufferMesh();this._renderState.swap&&(this._swapRenderStates(),this.requestRender())}}},{key:"lock",value:function(){this._renderState.locked=!0}},{key:"unlock",value:function(){this._renderState.locked=!1,this._flushUpdates(),this._swap()}},{key:"_swapRenderStates",value:function(){if(this._renderState.next){if(this._renderState.locked)return this._renderState.swap=!0,void this.requestRender();this._renderState.swap=!0,this._swap()}}},{key:"_swap",value:function(){this._renderState.swap&&(this._renderState.swap=!1,(0,d.pC)(this._renderState.next)&&(this._renderState.current.geometry.forEach((function(e){return e.destroy()})),this._renderState.current=this._renderState.next,this._renderState.next=null,this._requestLabelUpdate()))}},{key:"_flushUpdates",value:function(){for(var e=this._patches.maxSize;this._patches.size&&e--;)this._updateMesh(),this._swap()}},{key:"_updateBufferMesh",value:function(){var e=this._bufferPatches.peek();if(!(0,d.pC)(e)||!e.clear||null===this._renderState.next)for(;this._bufferPatches.size;){var t=this._bufferPatches.dequeue();(0,d.pC)(t)&&this._patchBuffer(t)}}},{key:"_updateMesh",value:function(){var e=this._patches.dequeue();if((0,d.pC)(e)){if((0,c.Z)("esri-2d-update-debug")){for(var t,i=e,r=null===(t=i.addOrUpdate)||void 0===t?void 0:t.tileKeyOrigin,n=this.key.id===r?"SELF":r,s="",a=0;a<5;a++){var u,o,l;s+=null!==(u=i.addOrUpdate)&&void 0!==u&&null!==(o=u.data[a])&&void 0!==o&&null!==(l=o.records)&&void 0!==l&&l.byteLength?1:0}console.debug(this.key.id,"FeatureTile:patch","[clear: ".concat(i.clear," origin: ").concat(n,", end:").concat(i.end," data:").concat(s,"]"))}!0===e.clear&&((0,d.pC)(this._renderState.next)&&(this._renderState.next.geometry.forEach((function(e){return e.destroy()})),this._renderState.next=null),this._renderState.next={geometry:new Map,metrics:null},(0,c.Z)("esri-2d-update-debug")&&console.debug(this.key.id,"FeatureTile:_updateMesh - Creating new renderState")),this.requestRender(),this._patch(e),e.end&&((0,c.Z)("esri-2d-update-debug")&&console.debug(this.key.id,"FeatureTile:_updateMesh - Encountered end message"),this.ready(),this._swapRenderStates())}}},{key:"_patch",value:function(e){var t=this;(0,b.Z_)((function(i){t._remove(i,e.remove),t._insert(i,e,!1)}))}},{key:"_patchBuffer",value:function(e){var t=this;(0,b.Z_)((function(i){t._insert(i,e,!0)}))}},{key:"_insert",value:function(e,t,i){try{var r,n,s=(0,d.Pt)(this._renderState.next,this._renderState.current),a=null===(r=t.addOrUpdate)||void 0===r?void 0:r.data[e],u=s.geometry;if((0,d.Wi)(a))return;u.has(e)||((0,c.Z)("esri-2d-update-debug")&&console.debug(this.key.id,"FeatureTile:_insert - Creating geometry buffer ".concat(e)),u.set(e,new L(e,this.stage))),(0,c.Z)("esri-2d-update-debug")&&console.debug(this.key.id,"FeatureTile:_insert - Inserting into ".concat(e,", version=").concat(null===(n=t.addOrUpdate)||void 0===n?void 0:n.version," stride=").concat(a.stride)),u.get(e).insert(a,t.sort,i),e===m.LW.LABEL&&this._insertLabelMetrics(t.type,a.metrics,t.clear)}catch(V){}}},{key:"_insertLabelMetrics",value:function(e,t,i){var r=(0,d.Pt)(this._renderState.next,this._renderState.current);if(!(0,d.Wi)(t)){var n=Z.from(t);if((0,d.Wi)(r.metrics))r.metrics=n;else{if("update"===e)for(var s=n.getCursor();s.next();)r.metrics.delete(s.id);r.metrics.link(n)}}}},{key:"_remove",value:function(e,t){var i=(0,d.Pt)(this._renderState.next,this._renderState.current).geometry.get(e);t&&t.length&&i&&(i.remove(t),this._removeLabelMetrics(t))}},{key:"_removeLabelMetrics",value:function(e){var t=(0,d.Pt)(this._renderState.next,this._renderState.current).metrics;if(!(0,d.Wi)(t)&&e.length){var i,r=(0,p.Z)(e);try{for(r.s();!(i=r.n()).done;)for(var n=i.value;t.delete(n););}catch(s){r.e(s)}finally{r.f()}}}},{key:"_dropPatches",value:function(){for(var e=this,t=new Array,i=!1;this._patches.size;){var r=this._patches.dequeue();if((0,d.Wi)(r))break;if(r.clear){if(i)break;i=!0}t.push(r)}this._patches.clear(),t.forEach((function(t){return e._patches.enqueue(t)}))}}]),i}(x.o),F=i(65760),q=i(40639),W=i(98290),O=i(93433),D=i(62272),Y=i(39383),H=(0,c.Z)("featurelayer-order-by-server-enabled"),X=function(e){(0,l.Z)(i,e);var t=(0,f.Z)(i);function i(e,r,n,a){var u;return(0,s.Z)(this,i),(u=t.call(this,e))._hitTestsRequests=[],u._layer=n,u._layerView=r,u._onUpdate=a,u}return(0,a.Z)(i,[{key:"renderChildren",value:function(e){this.attributeView.update(),this.hasAnimation&&e.painter.effects.integrate.draw(e,e.attributeView),(0,u.Z)((0,o.Z)(i.prototype),"renderChildren",this).call(this,e)}},{key:"hasEmptyAttributeView",value:function(){return this.attributeView.isEmpty()}},{key:"isUpdating",value:function(){return this.attributeView.isUpdating()}},{key:"hitTest",value:function(e){var t=this._hitTestsRequests.find((function(t){var i=t.x,r=t.y;return i===e.x&&r===e.y})),i=(0,v.hh)();return t?t.resolvers.push(i):(t={x:e.x,y:e.y,resolvers:[i]},this._hitTestsRequests.push(t)),this.requestRender(),i.promise}},{key:"onTileData",value:function(e,t){var i=H&&"orderBy"in this._layer&&this._layer.orderBy,r=i&&(null===i||void 0===i?void 0:i.length)&&!i[0].valueExpression&&i[0].field,n=!!i&&this._layerView.orderByFields===r;e.patch(t,n),this.contains(e)||this.addChild(e),this.requestRender()}},{key:"onTileError",value:function(e){this.contains(e)||this.addChild(e)}},{key:"updateTransitionProperties",value:function(e,t){(0,u.Z)((0,o.Z)(i.prototype),"updateTransitionProperties",this).call(this,e,t),this._layerView.featureEffectView.transitionStep(e,t),this._layerView.featureEffectView.transitioning&&this.requestRender()}},{key:"doRender",value:function(e){var t=this._layer.effectiveScaleRange,r=t.minScale,n=t.maxScale,s=e.state.scale;s<=(r||1/0)&&s>=n&&(0,u.Z)((0,o.Z)(i.prototype),"doRender",this).call(this,e)}},{key:"afterRender",value:function(e){(0,u.Z)((0,o.Z)(i.prototype),"afterRender",this).call(this,e),this._hitTestsRequests.length&&this.requestRender()}},{key:"onAttributeStoreUpdate",value:function(){this.hasLabels&&this._layerView.view.labelManager.requestUpdate(),this._onUpdate()}},{key:"hasAnimation",get:function(){return this.hasLabels}},{key:"setStencilReference",value:function(e){var t=e.rendererInfo.rendererSchema;if("dot-density"===(null===t||void 0===t?void 0:t.type)&&(null===t||void 0===t?void 0:t.dotSize)>1||"heatmap"===(null===t||void 0===t?void 0:t.type)){var r,n=(0,p.Z)(this.children);try{for(n.s();!(r=n.n()).done;){var s=r.value;s.stencilRef=s.key.level+1}}catch(a){n.e(a)}finally{n.f()}}else(0,u.Z)((0,o.Z)(i.prototype),"setStencilReference",this).call(this,e)}},{key:"hasLabels",get:function(){if("sublayers"in this._layer)return this._layer.sublayers.some((function(e){var t;return!(null===(t=e.labelingInfo)||void 0===t||!t.length)&&e.labelsVisible}));var e=this._layer.featureReduction,t=e&&"labelingInfo"in e&&e.labelsVisible&&e.labelingInfo&&e.labelingInfo.length;return this._layer.labelingInfo&&this._layer.labelingInfo.length&&this._layer.labelsVisible||!!t}},{key:"prepareRenderPasses",value:function(e){var t=this,r=e.registerRenderPass({name:"label",brushes:[D.U.label],target:function(){return t.hasLabels?t.children:null},drawPhase:m.jx.LABEL|m.jx.LABEL_ALPHA}),n=e.registerRenderPass({name:"geometry",brushes:[D.U.fill,D.U.dotDensity,D.U.line,D.U.marker,D.U.heatmap,D.U.pieChart,D.U.text],target:function(){return t.children},enableDefaultDraw:function(){return!t._layerView.featureEffectView.hasEffects},effects:[{apply:e.effects.outsideEffect,enable:function(){return t._layerView.featureEffectView.hasEffects},args:function(){return t._layerView.featureEffectView.excludedEffects}},{apply:e.effects.insideEffect,enable:function(){return t._layerView.featureEffectView.hasEffects},args:function(){return t._layerView.featureEffectView.includedEffects}},{apply:e.effects.hittest,enable:function(){return!!t._hitTestsRequests.length},args:function(){return t._hitTestsRequests}}]}),s=e.registerRenderPass({name:"highlight",brushes:[D.U.fill,D.U.dotDensity,D.U.line,D.U.marker,D.U.pieChart,D.U.text],target:function(){return t.children},drawPhase:m.jx.HIGHLIGHT,enableDefaultDraw:function(){return!1},effects:[{apply:e.effects.highlight,enable:function(){return!!t._layerView.hasHighlight()}}]});return[].concat((0,O.Z)((0,u.Z)((0,o.Z)(i.prototype),"prepareRenderPasses",this).call(this,e)),[n,s,r])}}]),i}(Y.T),K=function(e){(0,l.Z)(i,e);var t=(0,f.Z)(i);function i(){var e;return(0,s.Z)(this,i),(e=t.apply(this,arguments)).type="symbol",e}return(0,a.Z)(i,[{key:"install",value:function(e){var t=this,i=new X(this.tileInfoView,this.layerView,this.layer,(function(){return t.notifyChange("updating")}));this.featuresView=i,e.addChild(i)}},{key:"uninstall",value:function(e){e.removeChild(this.featuresView),this.featuresView=(0,d.SC)(this.featuresView)}},{key:"fetchResource",value:function(e,t){var i=e.url,r=this.featuresView.stage;try{return r.resourceManager.fetchResource(i,{signal:t.signal})}catch(T){return(0,v.D_)(T)?Promise.resolve({width:0,height:0}):Promise.reject(T)}}},{key:"isUpdating",value:function(){var e,t=(0,u.Z)((0,o.Z)(i.prototype),"isUpdating",this).call(this),r=!this.featuresView||this.featuresView.isUpdating(),n=null===(e=this.featuresView)||void 0===e?void 0:e.hasEmptyAttributeView(),s=t||r||t&&n;return(0,c.Z)("esri-2d-log-updating")&&console.log("Updating SymbolTileRenderer ".concat(s,"\n  -> updatingTiles ").concat(t,"\n  -> hasFeaturesView ").concat(!!this.featuresView,"\n  -> updatingFeaturesView ").concat(r)),s}},{key:"hitTest",value:function(e){return this.featuresView.hitTest(e)}},{key:"supportsRenderer",value:function(e){return null!=e&&["simple","class-breaks","unique-value","dot-density","dictionary","heatmap","pie-chart"].includes(e.type)}},{key:"onConfigUpdate",value:function(e){var t=null;if(e&&"visualVariables"in e){var i=((0,F.aR)(e).visualVariables||[]).map((function(e){var t=e.clone();return"normalizationField"in e&&(t.normalizationField=null),e.valueExpression&&"$view.scale"!==e.valueExpression&&(t.valueExpression=null,t.field="nop"),t}));t=(0,W.I)(i)}this.featuresView.setRendererInfo(e,t,this.layerView.featureEffect)}},{key:"onTileData",value:function(e){var t=this.tiles.get(e.tileKey);t&&e.data&&this.featuresView.onTileData(t,e.data),this.layerView.view.labelManager.requestUpdate()}},{key:"onTileError",value:function(e){var t=this.tiles.get(e.tileKey);t&&this.featuresView.onTileError(t)}},{key:"forceAttributeTextureUpload",value:function(){this.featuresView.attributeView.forceTextureUpload()}},{key:"lockGPUUploads",value:function(){this.featuresView.attributeView.lockTextureUpload(),this.tiles.forEach((function(e){return e.lock()}))}},{key:"unlockGPUUploads",value:function(){this.featuresView.attributeView.unlockTextureUpload(),this.tiles.forEach((function(e){return e.unlock()}))}},{key:"getMaterialItems",value:function(){var e=(0,n.Z)((0,r.Z)().mark((function e(t){return(0,r.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.featuresView.getMaterialItems(t));case 1:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"invalidateLabels",value:function(){this.featuresView.hasLabels&&this.layerView.view.labelManager.requestUpdate()}},{key:"createTile",value:function(e){var t=this,i=this.tileInfoView.getTileBounds((0,y.Ue)(),e),r=this.tileInfoView.getTileResolution(e.level),n=this.featuresView.attributeView;return new P(e,r,i[0],i[3],n,(function(){return t.layerView.view.labelManager.requestUpdate()}))}},{key:"disposeTile",value:function(e){this.featuresView.removeChild(e),e.destroy(),this.layerView.view.labelManager.requestUpdate()}}]),i}(q.Z),G=K=(0,h._)([(0,_.j)("esri.views.2d.layers.features.tileRenderers.SymbolTileRenderer")],K)},98290:function(e,t,i){i.d(t,{I:function(){return _},qc:function(){return h}});var r=i(1413),n=i(37762),s=i(92026),a=i(17842),u=i(65800),o=i(94109),l=i(80613),f=i(18745);function h(e,t){if(!e||!t)return e;switch(t){case"radius":case"distance":return 2*e;case"diameter":case"width":return e;case"area":return Math.sqrt(e)}return e}function c(e){return(null!==e&&void 0!==e?e:[]).map((function(e){return function(e){return{value:e.value,size:(0,a.t_)(e.size)}}(e)}))}function d(e){if("string"==typeof e||"number"==typeof e)return(0,a.t_)(e);var t=e;return{type:"size",expression:t.expression,stops:c(t.stops)}}var v=function(e){for(var t=[],i=[],r=c(e),n=r.length,s=0;s<6;s++){var u=r[Math.min(s,n-1)];t.push(u.value),i.push(null==u.size?o.AI:(0,a.F2)(u.size))}return{values:new Float32Array(t),sizes:new Float32Array(i)}};function _(e){var t,i=e&&e.length>0?{}:null,s=i?{}:null;if(!i||!s)return{vvFields:i,vvRanges:s};var a,u=(0,n.Z)(e);try{for(u.s();!(a=u.n()).done;){var o=a.value;if(o.field&&(i[o.type]=o.field),"size"===o.type){s.size||(s.size={});var h=o;switch((0,f.a)(h)){case l.X.SIZE_MINMAX_VALUE:s.size.minMaxValue={minDataValue:h.minDataValue,maxDataValue:h.maxDataValue,minSize:d(h.minSize),maxSize:d(h.maxSize)};break;case l.X.SIZE_SCALE_STOPS:s.size.scaleStops={stops:c(h.stops)};break;case l.X.SIZE_FIELD_STOPS:if(h.levels){var _={};for(var p in h.levels)_[p]=v(h.levels[p]);s.size.fieldStops={type:"level-dependent",levels:_}}else s.size.fieldStops=(0,r.Z)({type:"static"},v(h.stops));break;case l.X.SIZE_UNIT_VALUE:s.size.unitValue={unit:h.valueUnit,valueRepresentation:null!==(t=h.valueRepresentation)&&void 0!==t?t:void 0}}}else if("color"===o.type)s.color=g(o);else if("opacity"===o.type)s.opacity=y(o);else if("rotation"===o.type){var k=o;s.rotation={type:k.rotationType}}}}catch(m){u.e(m)}finally{u.f()}return{vvFields:i,vvRanges:s}}function y(e){var t={values:[0,0,0,0,0,0,0,0],opacities:[0,0,0,0,0,0,0,0]};if("string"==typeof e.field){if(!e.stops)return null;if(e.stops.length>8)return null;for(var i=e.stops,r=0;r<8;++r){var n=i[Math.min(r,i.length-1)];t.values[r]=n.value,t.opacities[r]=n.opacity}}else{if(!(e.stops&&e.stops.length>=0))return null;for(var s=e.stops&&e.stops.length>=0?e.stops[0].opacity:0,a=0;a<8;a++)t.values[a]=1/0,t.opacities[a]=s}return t}function p(e,t,i){e[4*t+0]=i.r/255,e[4*t+1]=i.g/255,e[4*t+2]=i.b/255,e[4*t+3]=i.a}function g(e){if((0,s.Wi)(e))return null;if(e.normalizationField)return null;var t={field:null,values:[0,0,0,0,0,0,0,0],colors:[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]};if("string"==typeof e.field){if(!e.stops)return null;if(e.stops.length>8)return null;t.field=e.field;for(var i=e.stops,r=0;r<8;++r){var n=i[Math.min(r,i.length-1)];t.values[r]=n.value,p(t.colors,r,n.color)}}else{if(!(e.stops&&e.stops.length>=0))return null;for(var a=e.stops&&e.stops.length>=0&&e.stops[0].color,o=0;o<8;o++)t.values[o]=1/0,p(t.colors,o,a)}for(var l=0;l<32;l+=4)(0,u.pr)(t.colors,l,!0);return t}}}]);
//# sourceMappingURL=7957.7a55cdcb.chunk.js.map