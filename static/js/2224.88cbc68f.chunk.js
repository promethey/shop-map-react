"use strict";(self.webpackChunkshop_map_react=self.webpackChunkshop_map_react||[]).push([[2224],{15909:function(e,r,t){t.d(r,{D:function(){return a}});var n=t(80292);function a(e){e&&e.writtenProperties&&e.writtenProperties.forEach((function(e){var r=e.target,t=e.propName,a=e.newOrigin;(0,n.l)(r)&&a&&r.originOf(t)!==a&&r.updateOrigin(t,a)}))}},80292:function(e,r,t){function n(e){return e&&"getAtOrigin"in e&&"originOf"in e}t.d(r,{l:function(){return n}})},2224:function(e,r,t){t.r(r),t.d(r,{save:function(){return H},saveAll:function(){return ee},saveAs:function(){return re}});var n=t(93433),a=t(37762),u=t(74165),o=t(15861),i=t(63780),s=t(10064),c=t(32718),l=t(92026),p=t(66978),f=t(15909),d=t(64326),y=t(25899),v=t(74368),m=t(37933),h=t(70032),Z=t(98995),w=t(32698),x=t(73117),b=c.Z.getLogger("esri.layers.FeatureLayer"),k="Feature Service";function g(e,r){return"Layer (title: ".concat(e.title,", id: ").concat(e.id,") of type '").concat(e.declaredClass,"' ").concat(r)}function I(e,r){if(r.type!==k)throw new s.Z("feature-layer:portal-item-wrong-type",g(e,'should have portal item of type "'.concat(k,'"')))}function S(e){return O.apply(this,arguments)}function O(){return(O=(0,o.Z)((0,u.Z)().mark((function e(r){return(0,u.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,r.load();case 2:if(!(0,m.rQ)(r)){e.next=4;break}throw new s.Z("feature-layer:save",g(r,"using an in-memory source cannot be saved to a portal item"));case 4:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function N(e,r){var t,n=(null!==(t=e.messages)&&void 0!==t?t:[]).filter((function(e){return"error"===e.type})).map((function(e){var r=e.name,t=e.message,n=e.details;return new s.Z(r,t,n)}));if(null!==r&&void 0!==r&&r.ignoreUnsupported&&(n=n.filter((function(e){var r=e.name;return"layer:unsupported"!==r&&"symbol:unsupported"!==r&&"symbol-layer:unsupported"!==r&&"property:unsupported"!==r&&"url:unsupported"!==r}))),n.length>0)throw new s.Z("feature-layer:save","Failed to save feature layer due to unsupported or invalid content. See 'details.errors' for more detailed information",{errors:n})}function P(e,r,t){return D.apply(this,arguments)}function D(){return(D=(0,o.Z)((0,u.Z)().mark((function e(r,t,n){var a;return(0,u.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.t0="beforeSave"in r&&"function"==typeof r.beforeSave,!e.t0){e.next=4;break}return e.next=4,r.beforeSave();case 4:return a=r.write({},t),e.abrupt("return",(N(t,n),a));case 6:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function K(e){var r=e.layer,t=e.layerJSON;return r.isTable?{layers:[],tables:[t]}:{layers:[t],tables:[]}}function T(e){(0,x.qj)(e,x.Kz.JSAPI),e.typeKeywords&&(e.typeKeywords=e.typeKeywords.filter((function(e,r,t){return t.indexOf(e)===r})))}function J(e){var r=e.portalItem;if(!r)throw b.error("save: requires the portalItem property to be set"),new s.Z("feature-layer:portal-item-not-set",g(e,"requires the portalItem property to be set"));if(!r.loaded)throw new s.Z("feature-layer:portal-item-not-loaded",g(e,"cannot be saved to a portal item that does not exist or is inaccessible"));I(e,r)}function A(e,r){return E.apply(this,arguments)}function E(){return(E=(0,o.Z)((0,u.Z)().mark((function e(r,t){var n;return(0,u.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",/\/\d+\/?$/.test(null!==(n=r.url)&&void 0!==n?n:"")?K(t[0]):L(r,t));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function L(e,r){return z.apply(this,arguments)}function z(){return(z=(0,o.Z)((0,u.Z)().mark((function e(r,t){var n,o,i,s,c,l,p,f;return(0,u.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t[0].layer,o=n.url,i=n.customParameters,s=n.apiKey,e.next=3,r.fetchData("json");case 3:if(c=e.sent,e.t0=c&&null!=c.layers&&null!=c.tables,e.t0){e.next=9;break}return e.next=8,j(c,{url:null!==o&&void 0!==o?o:"",customParameters:i,apiKey:s},t.map((function(e){return e.layer.layerId})));case 8:c=e.sent;case 9:l=(0,a.Z)(t);try{for(l.s();!(p=l.n()).done;)_((f=p.value).layer,f.layerJSON,c)}catch(u){l.e(u)}finally{l.f()}return e.abrupt("return",c);case 12:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function j(e,r,t){return q.apply(this,arguments)}function q(){return(q=(0,o.Z)((0,u.Z)().mark((function e(r,t,a){var o,i,s,c,l,p,f,d,y,m,h,Z;return(0,u.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r||(r={}),(o=r).layers||(o.layers=[]),(i=r).tables||(i.tables=[]),s=t.url,c=t.customParameters,l=t.apiKey,e.next=6,(0,v.V)(s,{customParameters:c,apiKey:l});case 6:return p=e.sent,f=p.serviceJSON,d=p.layersJSON,y=F(r.layers,f.layers,a),m=F(r.tables,f.tables,a),r.layers=y.itemResources,r.tables=m.itemResources,h=[].concat((0,n.Z)(y.added),(0,n.Z)(m.added)),Z=d?[].concat((0,n.Z)(d.layers),(0,n.Z)(d.tables)):[],e.next=15,R(r,h,s,Z);case 15:return e.abrupt("return",r);case 16:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function F(e,r,t){var n=(0,i.e5)(e,r,(function(e,r){return e.id===r.id}));e=e.filter((function(e){return!n.removed.some((function(r){return r.id===e.id}))}));var a=n.added.map((function(e){return{id:e.id}}));return a.forEach((function(r){var t=r.id;e.push({id:t})})),{itemResources:e,added:a.filter((function(e){var r=e.id;return!t.includes(r)}))}}function R(e,r,t,n){return Y.apply(this,arguments)}function Y(){return(Y=(0,o.Z)((0,u.Z)().mark((function e(r,t,n,a){var o;return(0,u.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return o=t.map((function(e){var r=e.id;return new d.default({url:n,layerId:r,sourceJSON:a.find((function(e){return e.id===r}))})})),e.next=3,(0,p.as)(o.map((function(e){return e.load()})));case 3:o.forEach((function(e){var t=e.layerId,n=e.loaded,a=e.defaultPopupTemplate;n&&!(0,l.Wi)(a)&&_(e,{id:t,popupInfo:a.toJSON()},r)}));case 4:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function _(e,r,t){e.isTable?C(t.tables,r):C(t.layers,r)}function C(e,r){if(e){var t=e.findIndex((function(e){return e.id===r.id}));-1===t?e.push(r):e[t]=r}}function U(e){var r=e.portalItem;return(0,m.y2)(e)&&!e.dynamicDataSource&&!(null===r||void 0===r||!r.loaded)&&r.type===k}function V(e){return M.apply(this,arguments)}function M(){return(M=(0,o.Z)((0,u.Z)().mark((function e(r){var t,n,o,i,c;return(0,u.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(null!==r&&void 0!==r&&r.length){e.next=2;break}throw new s.Z("feature-layer-utils-saveall:missing-parameters","'layers' array should contain at least one feature layer");case 2:return e.next=4,Promise.all(r.map((function(e){return e.load()})));case 4:t=(0,a.Z)(r),e.prev=5,t.s();case 7:if((n=t.n()).done){e.next=13;break}if(U(o=n.value)){e.next=11;break}throw new s.Z("feature-layer-utils-saveall:invalid-parameters","'layers' array should only contain layers or tables in a feature service loaded from 'Feature Service' item. ".concat(g(o,"does not conform")),{layer:o});case 11:e.next=7;break;case 13:e.next=18;break;case 15:e.prev=15,e.t0=e.catch(5),t.e(e.t0);case 18:return e.prev=18,t.f(),e.finish(18);case 21:if(i=r.map((function(e){return e.portalItem.id})),!(new Set(i).size>1)){e.next=24;break}throw new s.Z("feature-layer-utils-saveall:invalid-parameters","All layers in the 'layers' array should be loaded from the same portal item");case 24:if(c=r.map((function(e){return e.layerId})),new Set(c).size===c.length){e.next=27;break}throw new s.Z("feature-layer-utils-saveall:invalid-parameters","'layers' array should contain only one instance each of layer or table in a feature service");case 27:case"end":return e.stop()}}),e,null,[[5,15,18,21]])})))).apply(this,arguments)}function Q(e,r){var t,n,a,u,o=Z.default.from(r);return o.id&&((o=o.clone()).id=null),null!==(t=(a=o).type)&&void 0!==t||(a.type=k),null!==(n=(u=o).portal)&&void 0!==n||(u.portal=h.Z.getDefault()),I(e,o),o}function $(e,r){return B.apply(this,arguments)}function B(){return(B=(0,o.Z)((0,u.Z)().mark((function e(r,t){var n,a,o,i,s,c,p;return(0,u.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=r.url,a=r.layerId,o=r.title,i=r.fullExtent,s=r.isTable,c=(0,y.Qc)(n),p=(0,l.pC)(c)&&"FeatureServer"===c.serverType,t.url=p?n:"".concat(n,"/").concat(a),t.title||(t.title=o),t.extent=null,e.t0=!s&&(0,l.pC)(i),!e.t0){e.next=9;break}return e.next=8,(0,x.$o)(i);case 8:t.extent=e.sent;case 9:(0,x.ck)(t,x.Kz.METADATA),(0,x.ck)(t,x.Kz.MULTI_LAYER),(0,x.qj)(t,x.Kz.SINGLE_LAYER),s&&(0,x.qj)(t,x.Kz.TABLE),T(t);case 14:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function G(e,r,t){return W.apply(this,arguments)}function W(){return(W=(0,o.Z)((0,u.Z)().mark((function e(r,t,n){var a,o;return(0,u.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return o=r.portal,e.next=3,null===o||void 0===o?void 0:o.signIn();case 3:return e.next=5,null===o||void 0===o||null===(a=o.user)||void 0===a?void 0:a.addItem({item:r,data:t,folder:null===n||void 0===n?void 0:n.folder});case 5:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var H=(0,p.Ds)((function(e,r){return X.apply(this,arguments)}));function X(){return(X=(0,o.Z)((0,u.Z)().mark((function e(r,t){var n,a,o,i;return(0,u.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,S(r);case 2:return J(r),n=r.portalItem,a=(0,w.Y)(n),e.next=7,P(r,a,t);case 7:return o=e.sent,e.next=10,A(n,[{layer:r,layerJSON:o}]);case 10:return i=e.sent,T(n),e.next=14,n.update({data:i});case 14:return(0,f.D)(a),e.abrupt("return",n);case 16:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var ee=(0,p.Ds)(function(){var e=(0,o.Z)((0,u.Z)().mark((function e(r,t){var n,a,o,i;return(0,u.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,V(r);case 2:return n=r[0].portalItem,a=(0,w.Y)(n),e.next=6,Promise.all(r.map((function(e){return P(e,a,t)})));case 6:return o=e.sent,e.next=9,A(n,r.map((function(e,r){return{layer:e,layerJSON:o[r]}})));case 9:return i=e.sent,T(n),e.next=13,n.update({data:i});case 13:return e.next=15,Promise.all(r.slice(1).map((function(e){return e.portalItem.reload()})));case 15:return(0,f.D)(a),e.abrupt("return",n.clone());case 17:case"end":return e.stop()}}),e)})));return function(r,t){return e.apply(this,arguments)}}()),re=(0,p.Ds)((function(e,r,t){return te.apply(this,arguments)}));function te(){return(te=(0,o.Z)((0,u.Z)().mark((function e(r,t,n){var a,o,i;return(0,u.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,S(r);case 2:return a=Q(r,t),o=(0,w.Y)(a),e.t0=K,e.t1=r,e.next=8,P(r,o,n);case 8:return e.t2=e.sent,e.t3={layer:e.t1,layerJSON:e.t2},i=(0,e.t0)(e.t3),e.next=13,$(r,a);case 13:return e.next=15,G(a,i,n);case 15:return r.portalItem=a,(0,f.D)(o),e.abrupt("return",a);case 18:case"end":return e.stop()}}),e)})))).apply(this,arguments)}},74368:function(e,r,t){t.d(r,{V:function(){return o}});var n=t(74165),a=t(15861),u=t(41226);function o(e,r){return i.apply(this,arguments)}function i(){return i=(0,a.Z)((0,n.Z)().mark((function e(r,t){var a,o,i,c;return(0,n.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,(0,u.T)(r,t);case 2:if((o=e.sent).layers=o.layers.filter(s),i={serviceJSON:o},!((null!==(a=o.currentVersion)&&void 0!==a?a:0)<10.5)){e.next=7;break}return e.abrupt("return",i);case 7:return e.next=9,(0,u.T)(r+"/layers",t);case 9:return c=e.sent,e.abrupt("return",(i.layersJSON={layers:c.layers.filter(s),tables:c.tables},i));case 11:case"end":return e.stop()}}),e)}))),i.apply(this,arguments)}function s(e){return!e.type||"Feature Layer"===e.type}},32698:function(e,r,t){t.d(r,{Y:function(){return o},h:function(){return u}});var n=t(35995),a=t(70032);function u(e){return{origin:"portal-item",url:(0,n.mN)(e.itemUrl),portal:e.portal||a.Z.getDefault(),portalItem:e,readResourcePaths:[]}}function o(e){return{origin:"portal-item",messages:[],writtenProperties:[],url:e.itemUrl?(0,n.mN)(e.itemUrl):null,portal:e.portal||a.Z.getDefault(),portalItem:e}}},41226:function(e,r,t){t.d(r,{T:function(){return i}});var n=t(74165),a=t(1413),u=t(15861),o=t(76200);function i(e,r){return s.apply(this,arguments)}function s(){return s=(0,u.Z)((0,n.Z)().mark((function e(r,t){var u,i;return(0,n.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,(0,o.default)(r,{responseType:"json",query:(0,a.Z)((0,a.Z)({f:"json"},null===t||void 0===t?void 0:t.customParameters),{},{token:null===t||void 0===t?void 0:t.apiKey})});case 2:return u=e.sent,i=u.data,e.abrupt("return",i);case 5:case"end":return e.stop()}}),e)}))),s.apply(this,arguments)}}}]);
//# sourceMappingURL=2224.88cbc68f.chunk.js.map